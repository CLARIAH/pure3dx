<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>control.prepare API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>control.prepare</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/prepare.py#L1-L139" class="git-link">Browse git</a>
</summary>
<pre><code class="python">from pybars import Compiler

from control.messages import Messages as MessagesCls
from control.config import Config as ConfigCls
from control.mongo import Mongo as MongoCls
from control.viewers import Viewers as ViewersCls
from control.wrap import Wrap as WrapCls
from control.content import Content as ContentCls
from control.publish import Publish as PublishCls
from control.tailwind import Tailwind as TailwindCls
from control.pages import Pages as PagesCls
from control.auth import Auth as AuthCls
from control.generic import AttrDict
from control.authoidc import AuthOidc as AuthOidcCls


def prepare(design=False, migrate=False, trivial=False):
    &#34;&#34;&#34;Prepares the way for setting up the Flask webapp.

    Several classes are instantiated with a singleton object;
    each of these objects has a dedicated task in the app:

    * `control.config.Config.Settings`: all configuration aspects
    * `control.messages.Messages`: handle all messaging to user and sysadmin
    * `control.mongo.Mongo`: higher-level commands to the MongoDb
    * `control.viewers.Viewers`: support the third party 3D viewers
    * `control.wrap.Wrap`: several lengthy functions to wrap concepts into HTML
    * `control.datamodel.Datamodel`: factory for handling fields, inherited by `Content`
    * `control.content.Content`: retrieve all data that needs to be displayed
    * `control.publish.Publish`: publish an edition as static pages
    * `control.auth.Auth`: compute the permission of the current user
      to access content
    * `control.pages.Pages`: high-level functions that
      distribute content over the page

    !!! note &#34;Should be run once!&#34;
        These objects are used in several web apps:

        * the main web app
        * a copy of the main app that is enriched with the webdav functionality

        However, these objects should be initialized once, before either app starts,
        and the same objects should be passed to both invocations of the
        factory functions that make them (`control.app.appFactory`).

        The invocations are done in `control.webdavapp.appFactory`.

    Parameters
    ----------
    migrate: boolean, optional False
        If True, overrides the `trivial` parameter.
        It will initialize those objects that are needed for
        the migration of data.
    design: boolean, optional False
        If True, overrides the `trivial` parameter.
        It will initialize those objects that are needed for
        static page generation in the `Published` directory,
        assuming that the project/edition files have already been
        exported.
    trivial: boolean, optional False
        If `design` is False and `trivial` is True, skips the initialization of
        most objects.
        Useful if the pure3d app container should run without doing anything.
        This happens when we just want to start the container and run shell commands
        inside it, for example after a complicated refactoring when the flask app has
        too many bugs.

    Returns
    -------
    AttrDict
        A dictionary keyed by the names of the singleton objects and valued
        by the singleton objects themselves.

    &#34;&#34;&#34;
    if migrate:
        Settings = ConfigCls(MessagesCls(None), migrate=True).Settings
        Messages = MessagesCls(Settings)

        return AttrDict(Settings=Settings, Messages=Messages)

    if design:
        Settings = ConfigCls(MessagesCls(None), design=True).Settings
        Messages = MessagesCls(Settings)
        Tailwind = TailwindCls(Settings)
        Handlebars = Compiler()

        return AttrDict(
            Settings=Settings,
            Messages=Messages,
            Tailwind=Tailwind,
            Handlebars=Handlebars,
        )

    elif trivial:
        Settings = AttrDict(dict(secret_key=None))
        Messages = None
        Mongo = None
        Viewers = None
        Wrap = None
        Content = None
        Publish = None
        Auth = None
        Pages = None
        AuthOidc = None
    else:
        Settings = ConfigCls(MessagesCls(None)).Settings
        Messages = MessagesCls(Settings)
        Viewers = ViewersCls(Settings, Messages)

        Mongo = MongoCls(Settings, Messages)

        Wrap = WrapCls(Settings, Messages, Viewers)
        Tailwind = TailwindCls(Settings)
        Handlebars = Compiler()
        Content = ContentCls(Settings, Messages, Viewers, Mongo, Wrap)
        Publish = PublishCls(Settings, Messages, Viewers, Mongo, Content, Tailwind, Handlebars)
        Auth = AuthCls(Settings, Messages, Mongo, Content)
        AuthOidc = AuthOidcCls()

        Wrap.addAuth(Auth)
        Content.addAuth(Auth)
        Wrap.addContent(Content)
        Viewers.addAuth(Auth)

        Pages = PagesCls(Settings, Viewers, Messages, Mongo, Content, Auth)
        Messages.setFlask()

    return AttrDict(
        Settings=Settings,
        Messages=Messages,
        Mongo=Mongo,
        Viewers=Viewers,
        Wrap=Wrap,
        Content=Content,
        Publish=Publish,
        Auth=Auth,
        Pages=Pages,
        AuthOidc=AuthOidc,
    )</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="control.prepare.prepare"><code class="name flex">
<span>def <span class="ident">prepare</span></span>(<span>design=False, migrate=False, trivial=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Prepares the way for setting up the Flask webapp.</p>
<p>Several classes are instantiated with a singleton object;
each of these objects has a dedicated task in the app:</p>
<ul>
<li><code><a title="control.config.Config.Settings" href="config.html#control.config.Config.Settings">Config.Settings</a></code>: all configuration aspects</li>
<li><code><a title="control.messages.Messages" href="messages.html#control.messages.Messages">Messages</a></code>: handle all messaging to user and sysadmin</li>
<li><code><a title="control.mongo.Mongo" href="mongo.html#control.mongo.Mongo">Mongo</a></code>: higher-level commands to the MongoDb</li>
<li><code><a title="control.viewers.Viewers" href="viewers.html#control.viewers.Viewers">Viewers</a></code>: support the third party 3D viewers</li>
<li><code><a title="control.wrap.Wrap" href="wrap.html#control.wrap.Wrap">Wrap</a></code>: several lengthy functions to wrap concepts into HTML</li>
<li><code><a title="control.datamodel.Datamodel" href="datamodel.html#control.datamodel.Datamodel">Datamodel</a></code>: factory for handling fields, inherited by <code>Content</code></li>
<li><code><a title="control.content.Content" href="content.html#control.content.Content">Content</a></code>: retrieve all data that needs to be displayed</li>
<li><code><a title="control.publish.Publish" href="publish.html#control.publish.Publish">Publish</a></code>: publish an edition as static pages</li>
<li><code><a title="control.auth.Auth" href="auth.html#control.auth.Auth">Auth</a></code>: compute the permission of the current user
to access content</li>
<li><code><a title="control.pages.Pages" href="pages.html#control.pages.Pages">Pages</a></code>: high-level functions that
distribute content over the page</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Should be run once!</p>
<p>These objects are used in several web apps:</p>
<ul>
<li>the main web app</li>
<li>a copy of the main app that is enriched with the webdav functionality</li>
</ul>
<p>However, these objects should be initialized once, before either app starts,
and the same objects should be passed to both invocations of the
factory functions that make them (<code><a title="control.app.appFactory" href="app.html#control.app.appFactory">appFactory()</a></code>).</p>
<p>The invocations are done in <code><a title="control.webdavapp.appFactory" href="webdavapp.html#control.webdavapp.appFactory">appFactory()</a></code>.</p>
</div>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>migrate</code></strong> :&ensp;<code>boolean</code>, optional <code>False</code></dt>
<dd>If True, overrides the <code>trivial</code> parameter.
It will initialize those objects that are needed for
the migration of data.</dd>
<dt><strong><code>design</code></strong> :&ensp;<code>boolean</code>, optional <code>False</code></dt>
<dd>If True, overrides the <code>trivial</code> parameter.
It will initialize those objects that are needed for
static page generation in the <code>Published</code> directory,
assuming that the project/edition files have already been
exported.</dd>
<dt><strong><code>trivial</code></strong> :&ensp;<code>boolean</code>, optional <code>False</code></dt>
<dd>If <code>design</code> is False and <code>trivial</code> is True, skips the initialization of
most objects.
Useful if the pure3d app container should run without doing anything.
This happens when we just want to start the container and run shell commands
inside it, for example after a complicated refactoring when the flask app has
too many bugs.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>AttrDict</code></dt>
<dd>A dictionary keyed by the names of the singleton objects and valued
by the singleton objects themselves.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/prepare.py#L17-L139" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def prepare(design=False, migrate=False, trivial=False):
    &#34;&#34;&#34;Prepares the way for setting up the Flask webapp.

    Several classes are instantiated with a singleton object;
    each of these objects has a dedicated task in the app:

    * `control.config.Config.Settings`: all configuration aspects
    * `control.messages.Messages`: handle all messaging to user and sysadmin
    * `control.mongo.Mongo`: higher-level commands to the MongoDb
    * `control.viewers.Viewers`: support the third party 3D viewers
    * `control.wrap.Wrap`: several lengthy functions to wrap concepts into HTML
    * `control.datamodel.Datamodel`: factory for handling fields, inherited by `Content`
    * `control.content.Content`: retrieve all data that needs to be displayed
    * `control.publish.Publish`: publish an edition as static pages
    * `control.auth.Auth`: compute the permission of the current user
      to access content
    * `control.pages.Pages`: high-level functions that
      distribute content over the page

    !!! note &#34;Should be run once!&#34;
        These objects are used in several web apps:

        * the main web app
        * a copy of the main app that is enriched with the webdav functionality

        However, these objects should be initialized once, before either app starts,
        and the same objects should be passed to both invocations of the
        factory functions that make them (`control.app.appFactory`).

        The invocations are done in `control.webdavapp.appFactory`.

    Parameters
    ----------
    migrate: boolean, optional False
        If True, overrides the `trivial` parameter.
        It will initialize those objects that are needed for
        the migration of data.
    design: boolean, optional False
        If True, overrides the `trivial` parameter.
        It will initialize those objects that are needed for
        static page generation in the `Published` directory,
        assuming that the project/edition files have already been
        exported.
    trivial: boolean, optional False
        If `design` is False and `trivial` is True, skips the initialization of
        most objects.
        Useful if the pure3d app container should run without doing anything.
        This happens when we just want to start the container and run shell commands
        inside it, for example after a complicated refactoring when the flask app has
        too many bugs.

    Returns
    -------
    AttrDict
        A dictionary keyed by the names of the singleton objects and valued
        by the singleton objects themselves.

    &#34;&#34;&#34;
    if migrate:
        Settings = ConfigCls(MessagesCls(None), migrate=True).Settings
        Messages = MessagesCls(Settings)

        return AttrDict(Settings=Settings, Messages=Messages)

    if design:
        Settings = ConfigCls(MessagesCls(None), design=True).Settings
        Messages = MessagesCls(Settings)
        Tailwind = TailwindCls(Settings)
        Handlebars = Compiler()

        return AttrDict(
            Settings=Settings,
            Messages=Messages,
            Tailwind=Tailwind,
            Handlebars=Handlebars,
        )

    elif trivial:
        Settings = AttrDict(dict(secret_key=None))
        Messages = None
        Mongo = None
        Viewers = None
        Wrap = None
        Content = None
        Publish = None
        Auth = None
        Pages = None
        AuthOidc = None
    else:
        Settings = ConfigCls(MessagesCls(None)).Settings
        Messages = MessagesCls(Settings)
        Viewers = ViewersCls(Settings, Messages)

        Mongo = MongoCls(Settings, Messages)

        Wrap = WrapCls(Settings, Messages, Viewers)
        Tailwind = TailwindCls(Settings)
        Handlebars = Compiler()
        Content = ContentCls(Settings, Messages, Viewers, Mongo, Wrap)
        Publish = PublishCls(Settings, Messages, Viewers, Mongo, Content, Tailwind, Handlebars)
        Auth = AuthCls(Settings, Messages, Mongo, Content)
        AuthOidc = AuthOidcCls()

        Wrap.addAuth(Auth)
        Content.addAuth(Auth)
        Wrap.addContent(Content)
        Viewers.addAuth(Auth)

        Pages = PagesCls(Settings, Viewers, Messages, Mongo, Content, Auth)
        Messages.setFlask()

    return AttrDict(
        Settings=Settings,
        Messages=Messages,
        Mongo=Mongo,
        Viewers=Viewers,
        Wrap=Wrap,
        Content=Content,
        Publish=Publish,
        Auth=Auth,
        Pages=Pages,
        AuthOidc=AuthOidc,
    )</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<p><a href="https://github.com/CLARIAH/pure3dx" title="GitHub repo">GitHub</a></p>
<p><a href="https://github.com/CLARIAH/pure3dx/blob/main/stats.md" title="GitHub repo">code stats</a></p>
<form>
<input id="lunr-search" name="q" placeholder="🔎 Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="control" href="index.html">control</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="control.prepare.prepare" href="#control.prepare.prepare">prepare</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<a href="https://pure.knaw.nl/portal/en/persons/dirk-roorda">Dirk Roorda</a>
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>