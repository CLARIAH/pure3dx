<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>control.config API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>control.config</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L1-L664" class="git-link">Browse git</a>
</summary>
<pre><code class="python">from textwrap import dedent
from subprocess import check_output

from control.generic import AttrDict, getVersionKeyFunc
from control.files import dirMake, dirExists, fileExists, readYaml, readPath, listDirs
from control.environment import var
from control.html import HtmlElements


class Config:
    def __init__(self, Messages, design=False, migrate=False):
        &#34;&#34;&#34;All configuration details of the app.

        It is instantiated by a singleton object.

        Settings will be collected from the environment:

        * yaml files
        * environment variables
        * files and directories (for supported viewer software)

        !!! note &#34;Missing information&#34;
            If essential information is missing, the flask app will not be started,
            and no webserving will take place.

        Parameters
        ----------
        Messages: object
            Singleton instance of `control.messages.Messages`.
        design: boolean, optional False
            If True only settings are collected that are needed for
            static page generation in the `Published` directory,
            assuming that the project/edition files have already been
            exported.
        migrate: boolean, optional False
            If True only settings are collected that are needed for
            migration of data.
        &#34;&#34;&#34;
        self.Messages = Messages
        Messages.debugAdd(self)
        Messages.info(logmsg=&#34;CONFIG INIT&#34;)
        self.design = design
        self.migrate = migrate

        self.good = True
        Settings = AttrDict()
        Settings.H = HtmlElements(Settings, Messages)
        self.Settings = Settings
        &#34;&#34;&#34;The actual configuration settings are stored here.
        &#34;&#34;&#34;

        self.checkEnv()

        if not self.good:
            Messages.error(logmsg=&#34;Check environment failed&#34;)
            quit()

    def checkEnv(self):
        &#34;&#34;&#34;Collect the relevant information.

        If essential information is missing, processing stops.
        This is done by setting the `good` member of Config to False.
        &#34;&#34;&#34;

        for method in (
            self.checkRepo,
            self.checkWebdav,
            self.checkVersion,
            self.checkSecret,
            self.checkModes,
            self.checkData,
            self.checkMongo,
            self.checkSettings,
            self.checkDatamodel,
            self.checkAuth,
            self.checkViewers,
            self.checkBanner,
            self.checkDesign,
        ):
            if self.good:
                method()

    def checkRepo(self):
        &#34;&#34;&#34;Get the location of the pure3dx repository on the file system.&#34;&#34;&#34;
        Messages = self.Messages
        Settings = self.Settings

        repoDir = var(&#34;repodir&#34;)

        if repoDir is None:
            Messages.error(
                logmsg=dedent(
                    &#34;&#34;&#34;
                    Environment variable `repodir` not defined
                    Don&#39;t know where I must be running
                    &#34;&#34;&#34;
                )
            )
            self.good = False
            return

        if not dirExists(repoDir):
            Messages.error(
                logmsg=f&#34;Cannot run because repo dir does not exist: {repoDir}&#34;
            )
            self.good = False
            return

        Settings.repoDir = repoDir
        srcDir = f&#34;{repoDir}/src&#34;
        Settings.srcDir = srcDir
        yamlDir = f&#34;{srcDir}/yaml&#34;
        Settings.yamlDir = yamlDir

    def checkWebdav(self):
        &#34;&#34;&#34;Read the WEBDav methods from the webdav.yaml file.

        The methods are associated with the `read` or `update` keyword,
        depending on whether they are `GET` like or `PUT` like.
        &#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Settings = self.Settings
        yamlDir = Settings.yamlDir
        webdavFile = &#34;webdav.yml&#34;
        webdavInfo = readYaml(asFile=f&#34;{yamlDir}/{webdavFile}&#34;)
        Settings.webdavMethods = webdavInfo.methods

    def checkVersion(self):
        &#34;&#34;&#34;Get the current version of the pure3d app.

        We represent the version as the short hash of the current commit
        of the git repo that the running code is in.
        &#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Settings = self.Settings
        H = Settings.H
        repoDir = Settings.repoDir
        versionFile = f&#34;{repoDir}/VERSION.txt&#34;

        try:
            actual = True
            (long, short) = tuple(
                check_output([&#34;git&#34;, &#34;rev-parse&#34;, *args, &#34;HEAD&#34;], cwd=repoDir)
                .decode(&#34;ascii&#34;)
                .strip()
                for args in ([], [&#34;--short&#34;])
            )
            with open(versionFile, &#34;w&#34;) as fh:
                fh.write(f&#34;{long}\t{short}\n&#34;)
        except Exception as e:
            print(e.stderr)
            print(f&#34;Could not get version from git, reading it from file {versionFile}&#34;)
            actual = False
            if not fileExists(versionFile):
                known = False
                (long, short) = (&#34;&#34;, &#34;&#34;)
            else:
                known = True
                with open(versionFile) as fh:
                    try:
                        (long, short) = fh.read().strip().split(&#34;\t&#34;)
                    except Exception:
                        known = False
                        (long, short) = (&#34;&#34;, &#34;&#34;)

        Settings = self.Settings
        repoDir = Settings.repoDir

        if actual:
            label1 = &#34;this version&#34;
            text = f&#34;this version is {short}&#34;
        else:
            if known:
                label1 = &#34;previous version&#34;
                text = f&#34;previous version was {short}&#34;
            else:
                label1 = &#34;latest version&#34;
                text = &#34;unknown version, go to latest version&#34;

        title = f&#34;visit {label1} of the code on GitHub&#34;
        gitLocation = var(&#34;gitlocation&#34;).removesuffix(&#34;.git&#34;)
        href = f&#34;{gitLocation}/tree/{long}&#34; if long else gitLocation
        Settings.versionInfo = H.a(text, href, target=&#34;_blank&#34;, title=title)

    def checkSecret(self):
        &#34;&#34;&#34;Obtain a secret.

        This is secret information used for encrypting sessions.
        It resides somewhere on the file system, outside the pure3d repository.
        &#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Messages = self.Messages
        Settings = self.Settings

        CLIENT_SECRET_FILE = &#34;/app/secret/secfile&#34;
        secret = readPath(CLIENT_SECRET_FILE)

        if not secret:
            Messages.error(
                logmsg=(
                    &#34;No secret given for flask: &#34;
                    f&#34;file {CLIENT_SECRET_FILE} does not exist&#34;
                )
            )
            self.good = False
            return

        Settings.secret_key = secret

    def checkModes(self):
        &#34;&#34;&#34;Determine whether flask is running in test/pilot/custom/prod mode.&#34;&#34;&#34;
        Messages = self.Messages
        Settings = self.Settings

        if self.migrate:
            Settings.runMode = &#34;&#34;
            return

        runMode = var(&#34;runmode&#34;)

        if runMode is None:
            Messages.error(logmsg=&#34;Environment variable `runmode` not defined&#34;)
            self.good = False
            return

        if runMode in {&#34;test&#34;, &#34;pilot&#34;, &#34;custom&#34;}:
            runMode = runMode
        else:
            runMode = &#34;prod&#34;

        Settings.runMode = runMode
        Settings.runProd = runMode == &#34;prod&#34;
        &#34;&#34;&#34;In which mode the app runs.

        Values are:

        *   `test`:
            The app works with the example data.
            There is a row of test users on the interface,
            and that you can log in as one of these users with a single click,
            without any kind of authentication.
        *   `pilot`:
            The app works with the pilot data.
            There is a row of pilot users on the interface,
            and that you can log in as one of these users with a single click,
            without any kind of authentication.
        *   `custom`
            The app works with custom data.
            Initially, there is only one admin user, you can log in with a single click.
        *   All other run modes count as production mode, `prod`.
        &#34;&#34;&#34;

        if self.design:
            return

        debugMode = var(&#34;flaskdebug&#34;)
        if debugMode is None:
            Messages.error(logmsg=&#34;Environment variable `flaskdebug` not defined&#34;)
            self.good = False
            return

        Settings.debugMode = debugMode == &#34;v&#34;
        &#34;&#34;&#34;With debug mode enabled.

        This means that the unminified, development versions of the javascript libraries
        of the 3D viewers are loaded, instead of the production versions.
        &#34;&#34;&#34;

    def checkData(self):
        &#34;&#34;&#34;Get the location of the project data on the file system.&#34;&#34;&#34;
        Messages = self.Messages
        Settings = self.Settings
        runMode = Settings.runMode

        dataDir = var(&#34;DATA_DIR&#34;)

        if dataDir is None:
            Messages.error(logmsg=&#34;Environment variable `DATA_DIR` not defined&#34;)
            self.good = False
            return

        dataDir = dataDir.rstrip(&#34;/&#34;)

        if not dirExists(dataDir):
            Messages.error(logmsg=f&#34;Working data directory does not exist: {dataDir}&#34;)
            self.good = False
            return

        Settings.dataDir = dataDir

        sep = &#34;/&#34; if dataDir else &#34;&#34;
        workingParent = f&#34;{dataDir}{sep}working&#34;
        dirMake(workingParent)
        Settings.workingParent = workingParent

        if self.migrate:
            return

        workingDir = f&#34;{workingParent}/{runMode}&#34;
        dirMake(workingDir)
        Settings.workingDir = workingDir

        pubDir = var(&#34;PUB_DIR&#34;)

        if pubDir is None:
            Messages.error(logmsg=&#34;Environment variable `PUB_DIR` not defined&#34;)
            self.good = False
            return

        if not dirExists(pubDir):
            Messages.error(logmsg=f&#34;Pub directory does not exist: {pubDir}&#34;)
            self.good = False
            return

        pubDir = pubDir.rstrip(&#34;/&#34;)

        sep = &#34;/&#34; if pubDir else &#34;&#34;
        pubModeDir = f&#34;{pubDir}{sep}{runMode}&#34;

        dirMake(pubModeDir)
        Settings.pubDir = pubDir
        Settings.pubModeDir = pubModeDir

        pubUrl = var(&#34;PUB_URL&#34;)

        if pubUrl is None:
            Messages.error(logmsg=&#34;Environment variable `PUB_URL` not defined&#34;)
            self.good = False
            return

        Settings.pubUrl = pubUrl

        authorUrl = var(&#34;AUTHOR_URL&#34;)

        if authorUrl is None:
            Messages.error(logmsg=&#34;Environment variable `AUTHOR_URL` not defined&#34;)
            self.good = False
            return

        Settings.authorUrl = authorUrl

        if self.design:
            return

        importSubdir = (
            &#34;exampledata&#34;
            if runMode == &#34;test&#34;
            else &#34;pilotdata&#34;
            if runMode == &#34;pilot&#34;
            else &#34;customdata&#34;
            if runMode == &#34;custom&#34;
            else &#34;proddata&#34;
        )
        Settings.importDir = f&#34;{dataDir}/{importSubdir}&#34;

    def checkMongo(self):
        &#34;&#34;&#34;Obtain the connection details for MongDB.

        It is not checked whether connection with MongoDb actually works
        with these credentials.
        &#34;&#34;&#34;
        if self.design:
            return

        Messages = self.Messages
        Settings = self.Settings

        mongoHost = var(&#34;mongohost&#34;)
        mongoPort = var(&#34;mongoport&#34;)
        mongoPortOuter = var(&#34;mongoportouter&#34;)
        mongoUser = var(&#34;mongouser&#34;)
        mongoPassword = var(&#34;mongopassword&#34;)

        if mongoUser is None:
            Messages.error(logmsg=&#34;Environment variable `mongouser` not defined&#34;)
            self.good = False

        if mongoPassword is None:
            Messages.error(logmsg=&#34;Environment variable `mongopassword` not defined&#34;)
            self.good = False

        Settings.mongoHost = mongoHost
        Settings.mongoPort = int(mongoPort)
        Settings.mongoPortOuter = int(mongoPortOuter)
        Settings.mongoUser = mongoUser
        Settings.mongoPassword = mongoPassword

    def checkSettings(self):
        &#34;&#34;&#34;Read the yaml file with application settings.&#34;&#34;&#34;
        Messages = self.Messages
        Settings = self.Settings
        yamlDir = Settings.yamlDir

        settingsFile = &#34;settings.yml&#34;
        settings = readYaml(asFile=f&#34;{yamlDir}/{settingsFile}&#34;)
        if settings is None:
            Messages.error(logmsg=f&#34;Cannot read {settingsFile} in {yamlDir}&#34;)
            self.good = False
            return

        for k, v in settings.items():
            Settings[k] = v

    def checkDatamodel(self):
        &#34;&#34;&#34;Read the yaml file with table and field settings.

        It contains model `master` that contains the master tables
        with the information which tables are details of it.

        It also contains ``link` that contains the link tables
        with the information which tables are being linked.

        Both elements are needed when we delete records.

        If a user deletes a master record, its detail records become invalid.
        So either we must enforce that the user deletes the details first,
        or the system must delete those records automatically.

        When a user deletes a record that is linked to another record by means
        of a coupling record, the coupling record must be deleted automatically.

        Fields are bits of data that are stored in parts of records
        in MongoDb tables.

        Fields have several properties which we summarize under a key.
        So if we know the key of a field, we have access to all of its
        properties.

        The properties `nameSpave` and `fieldPath` determine how to drill
        down in a record in order to find the value of that field.

        The property `tp` is the data type of the field, default `string`.

        The property `caption` is a label that may accompany a field value
        on the interface.
        &#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Messages = self.Messages
        Settings = self.Settings

        yamlDir = Settings.yamlDir

        datamodelFile = &#34;datamodel.yml&#34;
        datamodel = readYaml(asFile=f&#34;{yamlDir}/{datamodelFile}&#34;)
        if datamodel is None:
            Messages.error(logmsg=f&#34;Cannot read {datamodelFile} in {yamlDir}&#34;)
            self.good = False
            return

        masterDetail = AttrDict()
        for detail, master in datamodel.detailMaster.items():
            masterDetail[master] = detail
        datamodel.masterDetail = masterDetail

        mainLink = AttrDict()
        for link, mains in datamodel.linkMain.items():
            for main in mains:
                mainLink.setdefault(main, []).append(link)
        datamodel.mainLink = mainLink

        Settings.datamodel = datamodel

    def checkAuth(self):
        &#34;&#34;&#34;Read the yaml file with the authorisation rules.&#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Messages = self.Messages
        Settings = self.Settings

        yamlDir = Settings.yamlDir

        authFile = &#34;authorise.yml&#34;
        authData = readYaml(asFile=f&#34;{yamlDir}/{authFile}&#34;)
        if authData is None:
            Messages.error(logmsg=f&#34;Cannot read {authFile} in {yamlDir}&#34;)
            self.good = False
            return

        Settings.auth = authData

        tableFromRole = AttrDict()

        for table, roles in authData.roles.items():
            for role in roles:
                tableFromRole[role] = table

        Settings.auth.tableFromRole = tableFromRole

        rank = {role: i for (i, role) in enumerate(authData.rolesOrder)}
        Settings.auth.roleRank = lambda role: rank[role]

    def checkViewers(self):
        &#34;&#34;&#34;Make an inventory of the supported 3D viewers.&#34;&#34;&#34;
        if self.migrate:
            return

        Messages = self.Messages
        Settings = self.Settings

        yamlDir = Settings.yamlDir
        dataDir = Settings.dataDir

        viewerDir = f&#34;{dataDir}/viewers&#34;

        Settings.viewerDir = viewerDir
        Settings.viewerUrlBase = &#34;/data/viewers&#34;

        versionKey = getVersionKeyFunc()
        Settings.versionKey = versionKey

        viewersFile = &#34;viewers.yml&#34;
        viewerSettingsFile = f&#34;{yamlDir}/{viewersFile}&#34;
        viewerSettings = readYaml(asFile=viewerSettingsFile)

        if viewerSettings is None:
            Messages.error(logmsg=f&#34;Cannot read {viewersFile} in {yamlDir}&#34;)
            self.good = False
            return

        if not dirExists(viewerDir):
            Messages.error(logmsg=f&#34;No viewer software directory: {viewerDir}&#34;)
            self.good = False
            return

        viewerNames = listDirs(viewerDir)

        for viewerName in viewerNames:
            if viewerName not in viewerSettings.viewers:
                Messages.warning(
                    logmsg=(
                        f&#34;Skipping viewer {viewerName} &#34;
                        f&#34;because it is not defined in {viewersFile}&#34;
                    )
                )
                continue
            viewerConfig = viewerSettings.viewers[viewerName]
            viewerPath = f&#34;{viewerDir}/{viewerName}&#34;

            versions = list(reversed(sorted(listDirs(viewerPath), key=versionKey)))

            if len(versions) == 0:
                self.good = False
                Messages.error(
                    logmsg=(
                        f&#34;Skipping viewer {viewerName} &#34;
                        f&#34;because there are no versions of it on the system&#34;
                    ),
                    stop=False
                )
                continue

            defaultVersion = versions[0]

            viewerConfig.versions = versions
            viewerConfig.defaultVersion = defaultVersion

        Settings.viewers = viewerSettings.viewers
        Settings.viewerActions = viewerSettings.actions
        Settings.viewerDefault = viewerSettings.default

    def checkBanner(self):
        &#34;&#34;&#34;Sets a banner for all pages.

        This banner may include warnings that the site is still work
        in progress.

        Returns
        -------
        void
            The banner is stored in the `banner` member of the
            `Settings` object.
        &#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Settings = self.Settings
        H = Settings.H
        wip = var(&#34;devstatus&#34;)
        runMode = Settings.runMode

        banner = &#34;&#34;

        if wip == &#34;wip&#34;:
            content = H.span(
                dedent(
                    &#34;&#34;&#34;
                    This site runs in Test Mode.
                    Data you enter can be erased without warning.
                    &#34;&#34;&#34;
                )
                if runMode == &#34;test&#34;
                else dedent(
                    &#34;&#34;&#34;
                    This site runs in Pilot Mode.
                    Data you enter will be saved, but might be inaccessible during
                    periods of further development.
                    &#34;&#34;&#34;
                )
                if runMode == &#34;pilot&#34;
                else dedent(
                    &#34;&#34;&#34;
                    This site runs in Custom Mode.
                    Modifications may be overwritten if other custom data is imported.
                    &#34;&#34;&#34;
                )
                if runMode == &#34;custom&#34;
                else dedent(
                    &#34;&#34;&#34;
                    This site is Work in Progress.
                    &#34;&#34;&#34;
                )
            )
            dataLink = &#34;«backups»&#34; + H.br()

            issueLink = H.a(
                &#34;issues&#34;,
                &#34;https://github.com/CLARIAH/pure3dx/issues&#34;,
                title=&#34;go to the issues on GitHub&#34;,
                cls=&#34;large&#34;,
                target=&#34;_blank&#34;,
            )
            banner = H.div(
                [content, issueLink, dataLink], id=&#34;statusbanner&#34;, cls=runMode
            )

        Settings.banner = banner

    def checkDesign(self):
        &#34;&#34;&#34;Checks the design resources.

        Returns
        -------
        void
            Some values are stored in the `Settings` object.
        &#34;&#34;&#34;
        if self.migrate:
            return

        Settings = self.Settings

        srcDir = Settings.srcDir
        designDir = f&#34;{srcDir}/design&#34;

        Settings.partialsIn = f&#34;{designDir}/components&#34;
        Settings.templateDir = f&#34;{designDir}/templates&#34;
        Settings.textDir = f&#34;{designDir}/texts&#34;
        Settings.imageDir = f&#34;{designDir}/images&#34;
        Settings.jsDir = f&#34;{designDir}/js&#34;
        Settings.cssIn = f&#34;{designDir}/css/input.css&#34;

        pubModeDir = Settings.pubModeDir
        Settings.cssOut = f&#34;{pubModeDir}/css/style.css&#34;

        dataDir = Settings.dataDir
        Settings.binDir = f&#34;{dataDir}/bin&#34;</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="control.config.Config"><code class="flex name class">
<span>class <span class="ident">Config</span></span>
<span>(</span><span>Messages, design=False, migrate=False)</span>
</code></dt>
<dd>
<div class="desc"><p>All configuration details of the app.</p>
<p>It is instantiated by a singleton object.</p>
<p>Settings will be collected from the environment:</p>
<ul>
<li>yaml files</li>
<li>environment variables</li>
<li>files and directories (for supported viewer software)</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Missing information</p>
<p>If essential information is missing, the flask app will not be started,
and no webserving will take place.</p>
</div>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>Messages</code></strong> :&ensp;<code>object</code></dt>
<dd>Singleton instance of <code><a title="control.messages.Messages" href="messages.html#control.messages.Messages">Messages</a></code>.</dd>
<dt><strong><code>design</code></strong> :&ensp;<code>boolean</code>, optional <code>False</code></dt>
<dd>If True only settings are collected that are needed for
static page generation in the <code>Published</code> directory,
assuming that the project/edition files have already been
exported.</dd>
<dt><strong><code>migrate</code></strong> :&ensp;<code>boolean</code>, optional <code>False</code></dt>
<dd>If True only settings are collected that are needed for
migration of data.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L10-L664" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class Config:
    def __init__(self, Messages, design=False, migrate=False):
        &#34;&#34;&#34;All configuration details of the app.

        It is instantiated by a singleton object.

        Settings will be collected from the environment:

        * yaml files
        * environment variables
        * files and directories (for supported viewer software)

        !!! note &#34;Missing information&#34;
            If essential information is missing, the flask app will not be started,
            and no webserving will take place.

        Parameters
        ----------
        Messages: object
            Singleton instance of `control.messages.Messages`.
        design: boolean, optional False
            If True only settings are collected that are needed for
            static page generation in the `Published` directory,
            assuming that the project/edition files have already been
            exported.
        migrate: boolean, optional False
            If True only settings are collected that are needed for
            migration of data.
        &#34;&#34;&#34;
        self.Messages = Messages
        Messages.debugAdd(self)
        Messages.info(logmsg=&#34;CONFIG INIT&#34;)
        self.design = design
        self.migrate = migrate

        self.good = True
        Settings = AttrDict()
        Settings.H = HtmlElements(Settings, Messages)
        self.Settings = Settings
        &#34;&#34;&#34;The actual configuration settings are stored here.
        &#34;&#34;&#34;

        self.checkEnv()

        if not self.good:
            Messages.error(logmsg=&#34;Check environment failed&#34;)
            quit()

    def checkEnv(self):
        &#34;&#34;&#34;Collect the relevant information.

        If essential information is missing, processing stops.
        This is done by setting the `good` member of Config to False.
        &#34;&#34;&#34;

        for method in (
            self.checkRepo,
            self.checkWebdav,
            self.checkVersion,
            self.checkSecret,
            self.checkModes,
            self.checkData,
            self.checkMongo,
            self.checkSettings,
            self.checkDatamodel,
            self.checkAuth,
            self.checkViewers,
            self.checkBanner,
            self.checkDesign,
        ):
            if self.good:
                method()

    def checkRepo(self):
        &#34;&#34;&#34;Get the location of the pure3dx repository on the file system.&#34;&#34;&#34;
        Messages = self.Messages
        Settings = self.Settings

        repoDir = var(&#34;repodir&#34;)

        if repoDir is None:
            Messages.error(
                logmsg=dedent(
                    &#34;&#34;&#34;
                    Environment variable `repodir` not defined
                    Don&#39;t know where I must be running
                    &#34;&#34;&#34;
                )
            )
            self.good = False
            return

        if not dirExists(repoDir):
            Messages.error(
                logmsg=f&#34;Cannot run because repo dir does not exist: {repoDir}&#34;
            )
            self.good = False
            return

        Settings.repoDir = repoDir
        srcDir = f&#34;{repoDir}/src&#34;
        Settings.srcDir = srcDir
        yamlDir = f&#34;{srcDir}/yaml&#34;
        Settings.yamlDir = yamlDir

    def checkWebdav(self):
        &#34;&#34;&#34;Read the WEBDav methods from the webdav.yaml file.

        The methods are associated with the `read` or `update` keyword,
        depending on whether they are `GET` like or `PUT` like.
        &#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Settings = self.Settings
        yamlDir = Settings.yamlDir
        webdavFile = &#34;webdav.yml&#34;
        webdavInfo = readYaml(asFile=f&#34;{yamlDir}/{webdavFile}&#34;)
        Settings.webdavMethods = webdavInfo.methods

    def checkVersion(self):
        &#34;&#34;&#34;Get the current version of the pure3d app.

        We represent the version as the short hash of the current commit
        of the git repo that the running code is in.
        &#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Settings = self.Settings
        H = Settings.H
        repoDir = Settings.repoDir
        versionFile = f&#34;{repoDir}/VERSION.txt&#34;

        try:
            actual = True
            (long, short) = tuple(
                check_output([&#34;git&#34;, &#34;rev-parse&#34;, *args, &#34;HEAD&#34;], cwd=repoDir)
                .decode(&#34;ascii&#34;)
                .strip()
                for args in ([], [&#34;--short&#34;])
            )
            with open(versionFile, &#34;w&#34;) as fh:
                fh.write(f&#34;{long}\t{short}\n&#34;)
        except Exception as e:
            print(e.stderr)
            print(f&#34;Could not get version from git, reading it from file {versionFile}&#34;)
            actual = False
            if not fileExists(versionFile):
                known = False
                (long, short) = (&#34;&#34;, &#34;&#34;)
            else:
                known = True
                with open(versionFile) as fh:
                    try:
                        (long, short) = fh.read().strip().split(&#34;\t&#34;)
                    except Exception:
                        known = False
                        (long, short) = (&#34;&#34;, &#34;&#34;)

        Settings = self.Settings
        repoDir = Settings.repoDir

        if actual:
            label1 = &#34;this version&#34;
            text = f&#34;this version is {short}&#34;
        else:
            if known:
                label1 = &#34;previous version&#34;
                text = f&#34;previous version was {short}&#34;
            else:
                label1 = &#34;latest version&#34;
                text = &#34;unknown version, go to latest version&#34;

        title = f&#34;visit {label1} of the code on GitHub&#34;
        gitLocation = var(&#34;gitlocation&#34;).removesuffix(&#34;.git&#34;)
        href = f&#34;{gitLocation}/tree/{long}&#34; if long else gitLocation
        Settings.versionInfo = H.a(text, href, target=&#34;_blank&#34;, title=title)

    def checkSecret(self):
        &#34;&#34;&#34;Obtain a secret.

        This is secret information used for encrypting sessions.
        It resides somewhere on the file system, outside the pure3d repository.
        &#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Messages = self.Messages
        Settings = self.Settings

        CLIENT_SECRET_FILE = &#34;/app/secret/secfile&#34;
        secret = readPath(CLIENT_SECRET_FILE)

        if not secret:
            Messages.error(
                logmsg=(
                    &#34;No secret given for flask: &#34;
                    f&#34;file {CLIENT_SECRET_FILE} does not exist&#34;
                )
            )
            self.good = False
            return

        Settings.secret_key = secret

    def checkModes(self):
        &#34;&#34;&#34;Determine whether flask is running in test/pilot/custom/prod mode.&#34;&#34;&#34;
        Messages = self.Messages
        Settings = self.Settings

        if self.migrate:
            Settings.runMode = &#34;&#34;
            return

        runMode = var(&#34;runmode&#34;)

        if runMode is None:
            Messages.error(logmsg=&#34;Environment variable `runmode` not defined&#34;)
            self.good = False
            return

        if runMode in {&#34;test&#34;, &#34;pilot&#34;, &#34;custom&#34;}:
            runMode = runMode
        else:
            runMode = &#34;prod&#34;

        Settings.runMode = runMode
        Settings.runProd = runMode == &#34;prod&#34;
        &#34;&#34;&#34;In which mode the app runs.

        Values are:

        *   `test`:
            The app works with the example data.
            There is a row of test users on the interface,
            and that you can log in as one of these users with a single click,
            without any kind of authentication.
        *   `pilot`:
            The app works with the pilot data.
            There is a row of pilot users on the interface,
            and that you can log in as one of these users with a single click,
            without any kind of authentication.
        *   `custom`
            The app works with custom data.
            Initially, there is only one admin user, you can log in with a single click.
        *   All other run modes count as production mode, `prod`.
        &#34;&#34;&#34;

        if self.design:
            return

        debugMode = var(&#34;flaskdebug&#34;)
        if debugMode is None:
            Messages.error(logmsg=&#34;Environment variable `flaskdebug` not defined&#34;)
            self.good = False
            return

        Settings.debugMode = debugMode == &#34;v&#34;
        &#34;&#34;&#34;With debug mode enabled.

        This means that the unminified, development versions of the javascript libraries
        of the 3D viewers are loaded, instead of the production versions.
        &#34;&#34;&#34;

    def checkData(self):
        &#34;&#34;&#34;Get the location of the project data on the file system.&#34;&#34;&#34;
        Messages = self.Messages
        Settings = self.Settings
        runMode = Settings.runMode

        dataDir = var(&#34;DATA_DIR&#34;)

        if dataDir is None:
            Messages.error(logmsg=&#34;Environment variable `DATA_DIR` not defined&#34;)
            self.good = False
            return

        dataDir = dataDir.rstrip(&#34;/&#34;)

        if not dirExists(dataDir):
            Messages.error(logmsg=f&#34;Working data directory does not exist: {dataDir}&#34;)
            self.good = False
            return

        Settings.dataDir = dataDir

        sep = &#34;/&#34; if dataDir else &#34;&#34;
        workingParent = f&#34;{dataDir}{sep}working&#34;
        dirMake(workingParent)
        Settings.workingParent = workingParent

        if self.migrate:
            return

        workingDir = f&#34;{workingParent}/{runMode}&#34;
        dirMake(workingDir)
        Settings.workingDir = workingDir

        pubDir = var(&#34;PUB_DIR&#34;)

        if pubDir is None:
            Messages.error(logmsg=&#34;Environment variable `PUB_DIR` not defined&#34;)
            self.good = False
            return

        if not dirExists(pubDir):
            Messages.error(logmsg=f&#34;Pub directory does not exist: {pubDir}&#34;)
            self.good = False
            return

        pubDir = pubDir.rstrip(&#34;/&#34;)

        sep = &#34;/&#34; if pubDir else &#34;&#34;
        pubModeDir = f&#34;{pubDir}{sep}{runMode}&#34;

        dirMake(pubModeDir)
        Settings.pubDir = pubDir
        Settings.pubModeDir = pubModeDir

        pubUrl = var(&#34;PUB_URL&#34;)

        if pubUrl is None:
            Messages.error(logmsg=&#34;Environment variable `PUB_URL` not defined&#34;)
            self.good = False
            return

        Settings.pubUrl = pubUrl

        authorUrl = var(&#34;AUTHOR_URL&#34;)

        if authorUrl is None:
            Messages.error(logmsg=&#34;Environment variable `AUTHOR_URL` not defined&#34;)
            self.good = False
            return

        Settings.authorUrl = authorUrl

        if self.design:
            return

        importSubdir = (
            &#34;exampledata&#34;
            if runMode == &#34;test&#34;
            else &#34;pilotdata&#34;
            if runMode == &#34;pilot&#34;
            else &#34;customdata&#34;
            if runMode == &#34;custom&#34;
            else &#34;proddata&#34;
        )
        Settings.importDir = f&#34;{dataDir}/{importSubdir}&#34;

    def checkMongo(self):
        &#34;&#34;&#34;Obtain the connection details for MongDB.

        It is not checked whether connection with MongoDb actually works
        with these credentials.
        &#34;&#34;&#34;
        if self.design:
            return

        Messages = self.Messages
        Settings = self.Settings

        mongoHost = var(&#34;mongohost&#34;)
        mongoPort = var(&#34;mongoport&#34;)
        mongoPortOuter = var(&#34;mongoportouter&#34;)
        mongoUser = var(&#34;mongouser&#34;)
        mongoPassword = var(&#34;mongopassword&#34;)

        if mongoUser is None:
            Messages.error(logmsg=&#34;Environment variable `mongouser` not defined&#34;)
            self.good = False

        if mongoPassword is None:
            Messages.error(logmsg=&#34;Environment variable `mongopassword` not defined&#34;)
            self.good = False

        Settings.mongoHost = mongoHost
        Settings.mongoPort = int(mongoPort)
        Settings.mongoPortOuter = int(mongoPortOuter)
        Settings.mongoUser = mongoUser
        Settings.mongoPassword = mongoPassword

    def checkSettings(self):
        &#34;&#34;&#34;Read the yaml file with application settings.&#34;&#34;&#34;
        Messages = self.Messages
        Settings = self.Settings
        yamlDir = Settings.yamlDir

        settingsFile = &#34;settings.yml&#34;
        settings = readYaml(asFile=f&#34;{yamlDir}/{settingsFile}&#34;)
        if settings is None:
            Messages.error(logmsg=f&#34;Cannot read {settingsFile} in {yamlDir}&#34;)
            self.good = False
            return

        for k, v in settings.items():
            Settings[k] = v

    def checkDatamodel(self):
        &#34;&#34;&#34;Read the yaml file with table and field settings.

        It contains model `master` that contains the master tables
        with the information which tables are details of it.

        It also contains ``link` that contains the link tables
        with the information which tables are being linked.

        Both elements are needed when we delete records.

        If a user deletes a master record, its detail records become invalid.
        So either we must enforce that the user deletes the details first,
        or the system must delete those records automatically.

        When a user deletes a record that is linked to another record by means
        of a coupling record, the coupling record must be deleted automatically.

        Fields are bits of data that are stored in parts of records
        in MongoDb tables.

        Fields have several properties which we summarize under a key.
        So if we know the key of a field, we have access to all of its
        properties.

        The properties `nameSpave` and `fieldPath` determine how to drill
        down in a record in order to find the value of that field.

        The property `tp` is the data type of the field, default `string`.

        The property `caption` is a label that may accompany a field value
        on the interface.
        &#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Messages = self.Messages
        Settings = self.Settings

        yamlDir = Settings.yamlDir

        datamodelFile = &#34;datamodel.yml&#34;
        datamodel = readYaml(asFile=f&#34;{yamlDir}/{datamodelFile}&#34;)
        if datamodel is None:
            Messages.error(logmsg=f&#34;Cannot read {datamodelFile} in {yamlDir}&#34;)
            self.good = False
            return

        masterDetail = AttrDict()
        for detail, master in datamodel.detailMaster.items():
            masterDetail[master] = detail
        datamodel.masterDetail = masterDetail

        mainLink = AttrDict()
        for link, mains in datamodel.linkMain.items():
            for main in mains:
                mainLink.setdefault(main, []).append(link)
        datamodel.mainLink = mainLink

        Settings.datamodel = datamodel

    def checkAuth(self):
        &#34;&#34;&#34;Read the yaml file with the authorisation rules.&#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Messages = self.Messages
        Settings = self.Settings

        yamlDir = Settings.yamlDir

        authFile = &#34;authorise.yml&#34;
        authData = readYaml(asFile=f&#34;{yamlDir}/{authFile}&#34;)
        if authData is None:
            Messages.error(logmsg=f&#34;Cannot read {authFile} in {yamlDir}&#34;)
            self.good = False
            return

        Settings.auth = authData

        tableFromRole = AttrDict()

        for table, roles in authData.roles.items():
            for role in roles:
                tableFromRole[role] = table

        Settings.auth.tableFromRole = tableFromRole

        rank = {role: i for (i, role) in enumerate(authData.rolesOrder)}
        Settings.auth.roleRank = lambda role: rank[role]

    def checkViewers(self):
        &#34;&#34;&#34;Make an inventory of the supported 3D viewers.&#34;&#34;&#34;
        if self.migrate:
            return

        Messages = self.Messages
        Settings = self.Settings

        yamlDir = Settings.yamlDir
        dataDir = Settings.dataDir

        viewerDir = f&#34;{dataDir}/viewers&#34;

        Settings.viewerDir = viewerDir
        Settings.viewerUrlBase = &#34;/data/viewers&#34;

        versionKey = getVersionKeyFunc()
        Settings.versionKey = versionKey

        viewersFile = &#34;viewers.yml&#34;
        viewerSettingsFile = f&#34;{yamlDir}/{viewersFile}&#34;
        viewerSettings = readYaml(asFile=viewerSettingsFile)

        if viewerSettings is None:
            Messages.error(logmsg=f&#34;Cannot read {viewersFile} in {yamlDir}&#34;)
            self.good = False
            return

        if not dirExists(viewerDir):
            Messages.error(logmsg=f&#34;No viewer software directory: {viewerDir}&#34;)
            self.good = False
            return

        viewerNames = listDirs(viewerDir)

        for viewerName in viewerNames:
            if viewerName not in viewerSettings.viewers:
                Messages.warning(
                    logmsg=(
                        f&#34;Skipping viewer {viewerName} &#34;
                        f&#34;because it is not defined in {viewersFile}&#34;
                    )
                )
                continue
            viewerConfig = viewerSettings.viewers[viewerName]
            viewerPath = f&#34;{viewerDir}/{viewerName}&#34;

            versions = list(reversed(sorted(listDirs(viewerPath), key=versionKey)))

            if len(versions) == 0:
                self.good = False
                Messages.error(
                    logmsg=(
                        f&#34;Skipping viewer {viewerName} &#34;
                        f&#34;because there are no versions of it on the system&#34;
                    ),
                    stop=False
                )
                continue

            defaultVersion = versions[0]

            viewerConfig.versions = versions
            viewerConfig.defaultVersion = defaultVersion

        Settings.viewers = viewerSettings.viewers
        Settings.viewerActions = viewerSettings.actions
        Settings.viewerDefault = viewerSettings.default

    def checkBanner(self):
        &#34;&#34;&#34;Sets a banner for all pages.

        This banner may include warnings that the site is still work
        in progress.

        Returns
        -------
        void
            The banner is stored in the `banner` member of the
            `Settings` object.
        &#34;&#34;&#34;
        if self.design or self.migrate:
            return

        Settings = self.Settings
        H = Settings.H
        wip = var(&#34;devstatus&#34;)
        runMode = Settings.runMode

        banner = &#34;&#34;

        if wip == &#34;wip&#34;:
            content = H.span(
                dedent(
                    &#34;&#34;&#34;
                    This site runs in Test Mode.
                    Data you enter can be erased without warning.
                    &#34;&#34;&#34;
                )
                if runMode == &#34;test&#34;
                else dedent(
                    &#34;&#34;&#34;
                    This site runs in Pilot Mode.
                    Data you enter will be saved, but might be inaccessible during
                    periods of further development.
                    &#34;&#34;&#34;
                )
                if runMode == &#34;pilot&#34;
                else dedent(
                    &#34;&#34;&#34;
                    This site runs in Custom Mode.
                    Modifications may be overwritten if other custom data is imported.
                    &#34;&#34;&#34;
                )
                if runMode == &#34;custom&#34;
                else dedent(
                    &#34;&#34;&#34;
                    This site is Work in Progress.
                    &#34;&#34;&#34;
                )
            )
            dataLink = &#34;«backups»&#34; + H.br()

            issueLink = H.a(
                &#34;issues&#34;,
                &#34;https://github.com/CLARIAH/pure3dx/issues&#34;,
                title=&#34;go to the issues on GitHub&#34;,
                cls=&#34;large&#34;,
                target=&#34;_blank&#34;,
            )
            banner = H.div(
                [content, issueLink, dataLink], id=&#34;statusbanner&#34;, cls=runMode
            )

        Settings.banner = banner

    def checkDesign(self):
        &#34;&#34;&#34;Checks the design resources.

        Returns
        -------
        void
            Some values are stored in the `Settings` object.
        &#34;&#34;&#34;
        if self.migrate:
            return

        Settings = self.Settings

        srcDir = Settings.srcDir
        designDir = f&#34;{srcDir}/design&#34;

        Settings.partialsIn = f&#34;{designDir}/components&#34;
        Settings.templateDir = f&#34;{designDir}/templates&#34;
        Settings.textDir = f&#34;{designDir}/texts&#34;
        Settings.imageDir = f&#34;{designDir}/images&#34;
        Settings.jsDir = f&#34;{designDir}/js&#34;
        Settings.cssIn = f&#34;{designDir}/css/input.css&#34;

        pubModeDir = Settings.pubModeDir
        Settings.cssOut = f&#34;{pubModeDir}/css/style.css&#34;

        dataDir = Settings.dataDir
        Settings.binDir = f&#34;{dataDir}/bin&#34;</code></pre>
</details>
<h3>Instance variables</h3>
<dl>
<dt id="control.config.Config.Settings"><code class="name">var <span class="ident">Settings</span></code></dt>
<dd>
<div class="desc"><p>The actual configuration settings are stored here.</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="control.config.Config.checkAuth"><code class="name flex">
<span>def <span class="ident">checkAuth</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Read the yaml file with the authorisation rules.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L471-L499" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkAuth(self):
    &#34;&#34;&#34;Read the yaml file with the authorisation rules.&#34;&#34;&#34;
    if self.design or self.migrate:
        return

    Messages = self.Messages
    Settings = self.Settings

    yamlDir = Settings.yamlDir

    authFile = &#34;authorise.yml&#34;
    authData = readYaml(asFile=f&#34;{yamlDir}/{authFile}&#34;)
    if authData is None:
        Messages.error(logmsg=f&#34;Cannot read {authFile} in {yamlDir}&#34;)
        self.good = False
        return

    Settings.auth = authData

    tableFromRole = AttrDict()

    for table, roles in authData.roles.items():
        for role in roles:
            tableFromRole[role] = table

    Settings.auth.tableFromRole = tableFromRole

    rank = {role: i for (i, role) in enumerate(authData.rolesOrder)}
    Settings.auth.roleRank = lambda role: rank[role]</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkBanner"><code class="name flex">
<span>def <span class="ident">checkBanner</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Sets a banner for all pages.</p>
<p>This banner may include warnings that the site is still work
in progress.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>void</code></dt>
<dd>The banner is stored in the <code>banner</code> member of the
<code>Settings</code> object.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L570-L635" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkBanner(self):
    &#34;&#34;&#34;Sets a banner for all pages.

    This banner may include warnings that the site is still work
    in progress.

    Returns
    -------
    void
        The banner is stored in the `banner` member of the
        `Settings` object.
    &#34;&#34;&#34;
    if self.design or self.migrate:
        return

    Settings = self.Settings
    H = Settings.H
    wip = var(&#34;devstatus&#34;)
    runMode = Settings.runMode

    banner = &#34;&#34;

    if wip == &#34;wip&#34;:
        content = H.span(
            dedent(
                &#34;&#34;&#34;
                This site runs in Test Mode.
                Data you enter can be erased without warning.
                &#34;&#34;&#34;
            )
            if runMode == &#34;test&#34;
            else dedent(
                &#34;&#34;&#34;
                This site runs in Pilot Mode.
                Data you enter will be saved, but might be inaccessible during
                periods of further development.
                &#34;&#34;&#34;
            )
            if runMode == &#34;pilot&#34;
            else dedent(
                &#34;&#34;&#34;
                This site runs in Custom Mode.
                Modifications may be overwritten if other custom data is imported.
                &#34;&#34;&#34;
            )
            if runMode == &#34;custom&#34;
            else dedent(
                &#34;&#34;&#34;
                This site is Work in Progress.
                &#34;&#34;&#34;
            )
        )
        dataLink = &#34;«backups»&#34; + H.br()

        issueLink = H.a(
            &#34;issues&#34;,
            &#34;https://github.com/CLARIAH/pure3dx/issues&#34;,
            title=&#34;go to the issues on GitHub&#34;,
            cls=&#34;large&#34;,
            target=&#34;_blank&#34;,
        )
        banner = H.div(
            [content, issueLink, dataLink], id=&#34;statusbanner&#34;, cls=runMode
        )

    Settings.banner = banner</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkData"><code class="name flex">
<span>def <span class="ident">checkData</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Get the location of the project data on the file system.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L275-L360" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkData(self):
    &#34;&#34;&#34;Get the location of the project data on the file system.&#34;&#34;&#34;
    Messages = self.Messages
    Settings = self.Settings
    runMode = Settings.runMode

    dataDir = var(&#34;DATA_DIR&#34;)

    if dataDir is None:
        Messages.error(logmsg=&#34;Environment variable `DATA_DIR` not defined&#34;)
        self.good = False
        return

    dataDir = dataDir.rstrip(&#34;/&#34;)

    if not dirExists(dataDir):
        Messages.error(logmsg=f&#34;Working data directory does not exist: {dataDir}&#34;)
        self.good = False
        return

    Settings.dataDir = dataDir

    sep = &#34;/&#34; if dataDir else &#34;&#34;
    workingParent = f&#34;{dataDir}{sep}working&#34;
    dirMake(workingParent)
    Settings.workingParent = workingParent

    if self.migrate:
        return

    workingDir = f&#34;{workingParent}/{runMode}&#34;
    dirMake(workingDir)
    Settings.workingDir = workingDir

    pubDir = var(&#34;PUB_DIR&#34;)

    if pubDir is None:
        Messages.error(logmsg=&#34;Environment variable `PUB_DIR` not defined&#34;)
        self.good = False
        return

    if not dirExists(pubDir):
        Messages.error(logmsg=f&#34;Pub directory does not exist: {pubDir}&#34;)
        self.good = False
        return

    pubDir = pubDir.rstrip(&#34;/&#34;)

    sep = &#34;/&#34; if pubDir else &#34;&#34;
    pubModeDir = f&#34;{pubDir}{sep}{runMode}&#34;

    dirMake(pubModeDir)
    Settings.pubDir = pubDir
    Settings.pubModeDir = pubModeDir

    pubUrl = var(&#34;PUB_URL&#34;)

    if pubUrl is None:
        Messages.error(logmsg=&#34;Environment variable `PUB_URL` not defined&#34;)
        self.good = False
        return

    Settings.pubUrl = pubUrl

    authorUrl = var(&#34;AUTHOR_URL&#34;)

    if authorUrl is None:
        Messages.error(logmsg=&#34;Environment variable `AUTHOR_URL` not defined&#34;)
        self.good = False
        return

    Settings.authorUrl = authorUrl

    if self.design:
        return

    importSubdir = (
        &#34;exampledata&#34;
        if runMode == &#34;test&#34;
        else &#34;pilotdata&#34;
        if runMode == &#34;pilot&#34;
        else &#34;customdata&#34;
        if runMode == &#34;custom&#34;
        else &#34;proddata&#34;
    )
    Settings.importDir = f&#34;{dataDir}/{importSubdir}&#34;</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkDatamodel"><code class="name flex">
<span>def <span class="ident">checkDatamodel</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Read the yaml file with table and field settings.</p>
<p>It contains model <code>master</code> that contains the master tables
with the information which tables are details of it.</p>
<p>It also contains <code>`link</code> that contains the link tables
with the information which tables are being linked.</p>
<p>Both elements are needed when we delete records.</p>
<p>If a user deletes a master record, its detail records become invalid.
So either we must enforce that the user deletes the details first,
or the system must delete those records automatically.</p>
<p>When a user deletes a record that is linked to another record by means
of a coupling record, the coupling record must be deleted automatically.</p>
<p>Fields are bits of data that are stored in parts of records
in MongoDb tables.</p>
<p>Fields have several properties which we summarize under a key.
So if we know the key of a field, we have access to all of its
properties.</p>
<p>The properties <code>nameSpave</code> and <code>fieldPath</code> determine how to drill
down in a record in order to find the value of that field.</p>
<p>The property <code>tp</code> is the data type of the field, default <code>string</code>.</p>
<p>The property <code>caption</code> is a label that may accompany a field value
on the interface.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L410-L469" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkDatamodel(self):
    &#34;&#34;&#34;Read the yaml file with table and field settings.

    It contains model `master` that contains the master tables
    with the information which tables are details of it.

    It also contains ``link` that contains the link tables
    with the information which tables are being linked.

    Both elements are needed when we delete records.

    If a user deletes a master record, its detail records become invalid.
    So either we must enforce that the user deletes the details first,
    or the system must delete those records automatically.

    When a user deletes a record that is linked to another record by means
    of a coupling record, the coupling record must be deleted automatically.

    Fields are bits of data that are stored in parts of records
    in MongoDb tables.

    Fields have several properties which we summarize under a key.
    So if we know the key of a field, we have access to all of its
    properties.

    The properties `nameSpave` and `fieldPath` determine how to drill
    down in a record in order to find the value of that field.

    The property `tp` is the data type of the field, default `string`.

    The property `caption` is a label that may accompany a field value
    on the interface.
    &#34;&#34;&#34;
    if self.design or self.migrate:
        return

    Messages = self.Messages
    Settings = self.Settings

    yamlDir = Settings.yamlDir

    datamodelFile = &#34;datamodel.yml&#34;
    datamodel = readYaml(asFile=f&#34;{yamlDir}/{datamodelFile}&#34;)
    if datamodel is None:
        Messages.error(logmsg=f&#34;Cannot read {datamodelFile} in {yamlDir}&#34;)
        self.good = False
        return

    masterDetail = AttrDict()
    for detail, master in datamodel.detailMaster.items():
        masterDetail[master] = detail
    datamodel.masterDetail = masterDetail

    mainLink = AttrDict()
    for link, mains in datamodel.linkMain.items():
        for main in mains:
            mainLink.setdefault(main, []).append(link)
    datamodel.mainLink = mainLink

    Settings.datamodel = datamodel</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkDesign"><code class="name flex">
<span>def <span class="ident">checkDesign</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Checks the design resources.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>void</code></dt>
<dd>Some values are stored in the <code>Settings</code> object.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L637-L664" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkDesign(self):
    &#34;&#34;&#34;Checks the design resources.

    Returns
    -------
    void
        Some values are stored in the `Settings` object.
    &#34;&#34;&#34;
    if self.migrate:
        return

    Settings = self.Settings

    srcDir = Settings.srcDir
    designDir = f&#34;{srcDir}/design&#34;

    Settings.partialsIn = f&#34;{designDir}/components&#34;
    Settings.templateDir = f&#34;{designDir}/templates&#34;
    Settings.textDir = f&#34;{designDir}/texts&#34;
    Settings.imageDir = f&#34;{designDir}/images&#34;
    Settings.jsDir = f&#34;{designDir}/js&#34;
    Settings.cssIn = f&#34;{designDir}/css/input.css&#34;

    pubModeDir = Settings.pubModeDir
    Settings.cssOut = f&#34;{pubModeDir}/css/style.css&#34;

    dataDir = Settings.dataDir
    Settings.binDir = f&#34;{dataDir}/bin&#34;</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkEnv"><code class="name flex">
<span>def <span class="ident">checkEnv</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Collect the relevant information.</p>
<p>If essential information is missing, processing stops.
This is done by setting the <code>good</code> member of Config to False.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L58-L81" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkEnv(self):
    &#34;&#34;&#34;Collect the relevant information.

    If essential information is missing, processing stops.
    This is done by setting the `good` member of Config to False.
    &#34;&#34;&#34;

    for method in (
        self.checkRepo,
        self.checkWebdav,
        self.checkVersion,
        self.checkSecret,
        self.checkModes,
        self.checkData,
        self.checkMongo,
        self.checkSettings,
        self.checkDatamodel,
        self.checkAuth,
        self.checkViewers,
        self.checkBanner,
        self.checkDesign,
    ):
        if self.good:
            method()</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkModes"><code class="name flex">
<span>def <span class="ident">checkModes</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Determine whether flask is running in test/pilot/custom/prod mode.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L216-L273" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkModes(self):
    &#34;&#34;&#34;Determine whether flask is running in test/pilot/custom/prod mode.&#34;&#34;&#34;
    Messages = self.Messages
    Settings = self.Settings

    if self.migrate:
        Settings.runMode = &#34;&#34;
        return

    runMode = var(&#34;runmode&#34;)

    if runMode is None:
        Messages.error(logmsg=&#34;Environment variable `runmode` not defined&#34;)
        self.good = False
        return

    if runMode in {&#34;test&#34;, &#34;pilot&#34;, &#34;custom&#34;}:
        runMode = runMode
    else:
        runMode = &#34;prod&#34;

    Settings.runMode = runMode
    Settings.runProd = runMode == &#34;prod&#34;
    &#34;&#34;&#34;In which mode the app runs.

    Values are:

    *   `test`:
        The app works with the example data.
        There is a row of test users on the interface,
        and that you can log in as one of these users with a single click,
        without any kind of authentication.
    *   `pilot`:
        The app works with the pilot data.
        There is a row of pilot users on the interface,
        and that you can log in as one of these users with a single click,
        without any kind of authentication.
    *   `custom`
        The app works with custom data.
        Initially, there is only one admin user, you can log in with a single click.
    *   All other run modes count as production mode, `prod`.
    &#34;&#34;&#34;

    if self.design:
        return

    debugMode = var(&#34;flaskdebug&#34;)
    if debugMode is None:
        Messages.error(logmsg=&#34;Environment variable `flaskdebug` not defined&#34;)
        self.good = False
        return

    Settings.debugMode = debugMode == &#34;v&#34;
    &#34;&#34;&#34;With debug mode enabled.

    This means that the unminified, development versions of the javascript libraries
    of the 3D viewers are loaded, instead of the production versions.
    &#34;&#34;&#34;</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkMongo"><code class="name flex">
<span>def <span class="ident">checkMongo</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Obtain the connection details for MongDB.</p>
<p>It is not checked whether connection with MongoDb actually works
with these credentials.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L362-L392" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkMongo(self):
    &#34;&#34;&#34;Obtain the connection details for MongDB.

    It is not checked whether connection with MongoDb actually works
    with these credentials.
    &#34;&#34;&#34;
    if self.design:
        return

    Messages = self.Messages
    Settings = self.Settings

    mongoHost = var(&#34;mongohost&#34;)
    mongoPort = var(&#34;mongoport&#34;)
    mongoPortOuter = var(&#34;mongoportouter&#34;)
    mongoUser = var(&#34;mongouser&#34;)
    mongoPassword = var(&#34;mongopassword&#34;)

    if mongoUser is None:
        Messages.error(logmsg=&#34;Environment variable `mongouser` not defined&#34;)
        self.good = False

    if mongoPassword is None:
        Messages.error(logmsg=&#34;Environment variable `mongopassword` not defined&#34;)
        self.good = False

    Settings.mongoHost = mongoHost
    Settings.mongoPort = int(mongoPort)
    Settings.mongoPortOuter = int(mongoPortOuter)
    Settings.mongoUser = mongoUser
    Settings.mongoPassword = mongoPassword</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkRepo"><code class="name flex">
<span>def <span class="ident">checkRepo</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Get the location of the pure3dx repository on the file system.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L83-L113" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkRepo(self):
    &#34;&#34;&#34;Get the location of the pure3dx repository on the file system.&#34;&#34;&#34;
    Messages = self.Messages
    Settings = self.Settings

    repoDir = var(&#34;repodir&#34;)

    if repoDir is None:
        Messages.error(
            logmsg=dedent(
                &#34;&#34;&#34;
                Environment variable `repodir` not defined
                Don&#39;t know where I must be running
                &#34;&#34;&#34;
            )
        )
        self.good = False
        return

    if not dirExists(repoDir):
        Messages.error(
            logmsg=f&#34;Cannot run because repo dir does not exist: {repoDir}&#34;
        )
        self.good = False
        return

    Settings.repoDir = repoDir
    srcDir = f&#34;{repoDir}/src&#34;
    Settings.srcDir = srcDir
    yamlDir = f&#34;{srcDir}/yaml&#34;
    Settings.yamlDir = yamlDir</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkSecret"><code class="name flex">
<span>def <span class="ident">checkSecret</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Obtain a secret.</p>
<p>This is secret information used for encrypting sessions.
It resides somewhere on the file system, outside the pure3d repository.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L189-L214" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkSecret(self):
    &#34;&#34;&#34;Obtain a secret.

    This is secret information used for encrypting sessions.
    It resides somewhere on the file system, outside the pure3d repository.
    &#34;&#34;&#34;
    if self.design or self.migrate:
        return

    Messages = self.Messages
    Settings = self.Settings

    CLIENT_SECRET_FILE = &#34;/app/secret/secfile&#34;
    secret = readPath(CLIENT_SECRET_FILE)

    if not secret:
        Messages.error(
            logmsg=(
                &#34;No secret given for flask: &#34;
                f&#34;file {CLIENT_SECRET_FILE} does not exist&#34;
            )
        )
        self.good = False
        return

    Settings.secret_key = secret</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkSettings"><code class="name flex">
<span>def <span class="ident">checkSettings</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Read the yaml file with application settings.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L394-L408" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkSettings(self):
    &#34;&#34;&#34;Read the yaml file with application settings.&#34;&#34;&#34;
    Messages = self.Messages
    Settings = self.Settings
    yamlDir = Settings.yamlDir

    settingsFile = &#34;settings.yml&#34;
    settings = readYaml(asFile=f&#34;{yamlDir}/{settingsFile}&#34;)
    if settings is None:
        Messages.error(logmsg=f&#34;Cannot read {settingsFile} in {yamlDir}&#34;)
        self.good = False
        return

    for k, v in settings.items():
        Settings[k] = v</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkVersion"><code class="name flex">
<span>def <span class="ident">checkVersion</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Get the current version of the pure3d app.</p>
<p>We represent the version as the short hash of the current commit
of the git repo that the running code is in.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L130-L187" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkVersion(self):
    &#34;&#34;&#34;Get the current version of the pure3d app.

    We represent the version as the short hash of the current commit
    of the git repo that the running code is in.
    &#34;&#34;&#34;
    if self.design or self.migrate:
        return

    Settings = self.Settings
    H = Settings.H
    repoDir = Settings.repoDir
    versionFile = f&#34;{repoDir}/VERSION.txt&#34;

    try:
        actual = True
        (long, short) = tuple(
            check_output([&#34;git&#34;, &#34;rev-parse&#34;, *args, &#34;HEAD&#34;], cwd=repoDir)
            .decode(&#34;ascii&#34;)
            .strip()
            for args in ([], [&#34;--short&#34;])
        )
        with open(versionFile, &#34;w&#34;) as fh:
            fh.write(f&#34;{long}\t{short}\n&#34;)
    except Exception as e:
        print(e.stderr)
        print(f&#34;Could not get version from git, reading it from file {versionFile}&#34;)
        actual = False
        if not fileExists(versionFile):
            known = False
            (long, short) = (&#34;&#34;, &#34;&#34;)
        else:
            known = True
            with open(versionFile) as fh:
                try:
                    (long, short) = fh.read().strip().split(&#34;\t&#34;)
                except Exception:
                    known = False
                    (long, short) = (&#34;&#34;, &#34;&#34;)

    Settings = self.Settings
    repoDir = Settings.repoDir

    if actual:
        label1 = &#34;this version&#34;
        text = f&#34;this version is {short}&#34;
    else:
        if known:
            label1 = &#34;previous version&#34;
            text = f&#34;previous version was {short}&#34;
        else:
            label1 = &#34;latest version&#34;
            text = &#34;unknown version, go to latest version&#34;

    title = f&#34;visit {label1} of the code on GitHub&#34;
    gitLocation = var(&#34;gitlocation&#34;).removesuffix(&#34;.git&#34;)
    href = f&#34;{gitLocation}/tree/{long}&#34; if long else gitLocation
    Settings.versionInfo = H.a(text, href, target=&#34;_blank&#34;, title=title)</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkViewers"><code class="name flex">
<span>def <span class="ident">checkViewers</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Make an inventory of the supported 3D viewers.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L501-L568" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkViewers(self):
    &#34;&#34;&#34;Make an inventory of the supported 3D viewers.&#34;&#34;&#34;
    if self.migrate:
        return

    Messages = self.Messages
    Settings = self.Settings

    yamlDir = Settings.yamlDir
    dataDir = Settings.dataDir

    viewerDir = f&#34;{dataDir}/viewers&#34;

    Settings.viewerDir = viewerDir
    Settings.viewerUrlBase = &#34;/data/viewers&#34;

    versionKey = getVersionKeyFunc()
    Settings.versionKey = versionKey

    viewersFile = &#34;viewers.yml&#34;
    viewerSettingsFile = f&#34;{yamlDir}/{viewersFile}&#34;
    viewerSettings = readYaml(asFile=viewerSettingsFile)

    if viewerSettings is None:
        Messages.error(logmsg=f&#34;Cannot read {viewersFile} in {yamlDir}&#34;)
        self.good = False
        return

    if not dirExists(viewerDir):
        Messages.error(logmsg=f&#34;No viewer software directory: {viewerDir}&#34;)
        self.good = False
        return

    viewerNames = listDirs(viewerDir)

    for viewerName in viewerNames:
        if viewerName not in viewerSettings.viewers:
            Messages.warning(
                logmsg=(
                    f&#34;Skipping viewer {viewerName} &#34;
                    f&#34;because it is not defined in {viewersFile}&#34;
                )
            )
            continue
        viewerConfig = viewerSettings.viewers[viewerName]
        viewerPath = f&#34;{viewerDir}/{viewerName}&#34;

        versions = list(reversed(sorted(listDirs(viewerPath), key=versionKey)))

        if len(versions) == 0:
            self.good = False
            Messages.error(
                logmsg=(
                    f&#34;Skipping viewer {viewerName} &#34;
                    f&#34;because there are no versions of it on the system&#34;
                ),
                stop=False
            )
            continue

        defaultVersion = versions[0]

        viewerConfig.versions = versions
        viewerConfig.defaultVersion = defaultVersion

    Settings.viewers = viewerSettings.viewers
    Settings.viewerActions = viewerSettings.actions
    Settings.viewerDefault = viewerSettings.default</code></pre>
</details>
</dd>
<dt id="control.config.Config.checkWebdav"><code class="name flex">
<span>def <span class="ident">checkWebdav</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Read the WEBDav methods from the webdav.yaml file.</p>
<p>The methods are associated with the <code>read</code> or <code>update</code> keyword,
depending on whether they are <code>GET</code> like or <code>PUT</code> like.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/1a4455072b1ffa872b86f15d4e31826810cd1f2e/src/control/config.py#L115-L128" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def checkWebdav(self):
    &#34;&#34;&#34;Read the WEBDav methods from the webdav.yaml file.

    The methods are associated with the `read` or `update` keyword,
    depending on whether they are `GET` like or `PUT` like.
    &#34;&#34;&#34;
    if self.design or self.migrate:
        return

    Settings = self.Settings
    yamlDir = Settings.yamlDir
    webdavFile = &#34;webdav.yml&#34;
    webdavInfo = readYaml(asFile=f&#34;{yamlDir}/{webdavFile}&#34;)
    Settings.webdavMethods = webdavInfo.methods</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<p><a href="https://github.com/CLARIAH/pure3dx" title="GitHub repo">GitHub</a></p>
<p><a href="https://github.com/CLARIAH/pure3dx/blob/main/stats.md" title="GitHub repo">code stats</a></p>
<form>
<input id="lunr-search" name="q" placeholder="🔎 Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="control" href="index.html">control</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="control.config.Config" href="#control.config.Config">Config</a></code></h4>
<ul class="two-column">
<li><code><a title="control.config.Config.Settings" href="#control.config.Config.Settings">Settings</a></code></li>
<li><code><a title="control.config.Config.checkAuth" href="#control.config.Config.checkAuth">checkAuth</a></code></li>
<li><code><a title="control.config.Config.checkBanner" href="#control.config.Config.checkBanner">checkBanner</a></code></li>
<li><code><a title="control.config.Config.checkData" href="#control.config.Config.checkData">checkData</a></code></li>
<li><code><a title="control.config.Config.checkDatamodel" href="#control.config.Config.checkDatamodel">checkDatamodel</a></code></li>
<li><code><a title="control.config.Config.checkDesign" href="#control.config.Config.checkDesign">checkDesign</a></code></li>
<li><code><a title="control.config.Config.checkEnv" href="#control.config.Config.checkEnv">checkEnv</a></code></li>
<li><code><a title="control.config.Config.checkModes" href="#control.config.Config.checkModes">checkModes</a></code></li>
<li><code><a title="control.config.Config.checkMongo" href="#control.config.Config.checkMongo">checkMongo</a></code></li>
<li><code><a title="control.config.Config.checkRepo" href="#control.config.Config.checkRepo">checkRepo</a></code></li>
<li><code><a title="control.config.Config.checkSecret" href="#control.config.Config.checkSecret">checkSecret</a></code></li>
<li><code><a title="control.config.Config.checkSettings" href="#control.config.Config.checkSettings">checkSettings</a></code></li>
<li><code><a title="control.config.Config.checkVersion" href="#control.config.Config.checkVersion">checkVersion</a></code></li>
<li><code><a title="control.config.Config.checkViewers" href="#control.config.Config.checkViewers">checkViewers</a></code></li>
<li><code><a title="control.config.Config.checkWebdav" href="#control.config.Config.checkWebdav">checkWebdav</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<a href="https://pure.knaw.nl/portal/en/persons/dirk-roorda">Dirk Roorda</a>
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>