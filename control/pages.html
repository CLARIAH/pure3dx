<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>control.pages API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>control.pages</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L1-L590" class="git-link">Browse git</a>
</summary>
<pre><code class="python">from control.flask import redirectStatus, template, send, stop, getReferrer
from control.html import HtmlElements as H


class Pages:
    def __init__(self, Settings, Viewers, Messages, Content, Auth):
        &#34;&#34;&#34;Making responses that can be displayed as web pages.

        This class has methods that correspond to routes in the app,
        for which they get the data (using `control.content.Content`),
        which gets then wrapped in HTML.

        It is instantiated by a singleton object.

        Most methods generate a response that contains the content of a complete
        page. For those methods we do not document the return value.

        Some methods return something different.
        If so, it the return value will be documented.

        Parameters
        ----------
        Settings: `control.generic.AttrDict`
            App-wide configuration data obtained from
            `control.config.Config.Settings`.
        Viewers: object
            Singleton instance of `control.viewers.Viewers`.
        Messages: object
            Singleton instance of `control.messages.Messages`.
        Mongo: object
            Singleton instance of `control.mongo.Mongo`.
        Content: object
            Singleton instance of `control.content.Content`.
        Auth: object
            Singleton instance of `control.auth.Auth`.
        &#34;&#34;&#34;
        self.Settings = Settings
        self.Viewers = Viewers
        self.Messages = Messages
        Messages.debugAdd(self)
        self.Content = Content
        self.Auth = Auth

    def home(self):
        &#34;&#34;&#34;The site-wide home page.&#34;&#34;&#34;
        left = self.putValues(&#34;siteTitle@1 + abstract@2&#34;)
        return self.page(&#34;home&#34;, left=left)

    def about(self):
        &#34;&#34;&#34;The site-wide about page.&#34;&#34;&#34;
        left = self.putValues(&#34;siteTitle@1 + abstract@2&#34;)
        right = self.putValues(&#34;description@2 + provenance@2&#34;)
        return self.page(&#34;about&#34;, left=left, right=right)

    def surprise(self):
        &#34;&#34;&#34;The &#34;surprise me!&#34; page.&#34;&#34;&#34;
        Content = self.Content
        surpriseMe = Content.getSurprise()
        left = self.putValues(&#34;siteTitle@1&#34;)
        right = surpriseMe
        return self.page(&#34;surpriseme&#34;, left=left, right=right)

    def projects(self):
        &#34;&#34;&#34;The page with the list of projects.&#34;&#34;&#34;
        Content = self.Content
        projects = Content.getProjects()
        left = self.putValues(&#34;siteTitle@2&#34;) + projects
        return self.page(&#34;projects&#34;, left=left)

    def projectInsert(self):
        &#34;&#34;&#34;Inserts a project and shows the new project.&#34;&#34;&#34;
        Messages = self.Messages
        Content = self.Content
        projectId = Content.insertProject()
        if projectId is None:
            Messages.warning(
                logmsg=&#34;Could not create new project&#34;,
                msg=&#34;failed to create new project&#34;,
            )
            newUrl = &#34;/projects&#34;
        else:
            Messages.info(
                logmsg=f&#34;Created project {projectId}&#34;, msg=&#34;new project created&#34;
            )
            newUrl = f&#34;/projects/{projectId}&#34;
        return redirectStatus(newUrl, projectId is not None)

    def project(self, projectId):
        &#34;&#34;&#34;The landing page of a project.

        Parameters
        ----------
        projectId: ObjectId
            The project in question.
        &#34;&#34;&#34;
        Content = self.Content
        editions = Content.getEditions(projectId)
        left = self.putValues(&#34;title@3 + creator@0&#34;, projectId=projectId) + editions
        right = self.putValues(
            &#34;abstract@4 + description@4 + provenance@4 + instructionalMethod@4&#34;,
            projectId=projectId,
        )
        return self.page(&#34;projects&#34;, left=left, right=right)

    def editionInsert(self, projectId):
        &#34;&#34;&#34;Inserts an edition into a project and shows the new edition.

        Parameters
        ----------
        projectId: ObjectId
            The project to which the edition belongs.
        &#34;&#34;&#34;
        Messages = self.Messages
        Content = self.Content
        editionId = Content.insertEdition(projectId)
        if editionId is None:
            Messages.warning(
                logmsg=&#34;Could not create new edition&#34;,
                msg=&#34;failed to create new edition&#34;,
            )
            newUrl = f&#34;/projects/{projectId}&#34;
        else:
            Messages.info(
                logmsg=f&#34;Created edition {editionId}&#34;, msg=&#34;new edition created&#34;
            )
            newUrl = f&#34;/editions/{editionId}&#34;
        return redirectStatus(newUrl, editionId is not None)

    def edition(self, editionId):
        &#34;&#34;&#34;The landing page of an edition.

        This page contains a list of scenes.
        One of these scenes will be loaded in a 3D viewer.
        It is dependent on defaults which scene in which viewer/version/mode.

        Parameters
        ----------
        editionId: ObjectId
            The edition in question.
            From the edition record we can find the project too.
        &#34;&#34;&#34;
        Content = self.Content
        editionInfo = Content.getItem(&#34;editions&#34;, _id=editionId)
        projectId = editionInfo.projectId
        return self.scenes(projectId, editionId, None, None, None, None)

    def scene(self, sceneId, viewer, version, action):
        &#34;&#34;&#34;The landing page of an edition, but with a scene marked as active.

        This page contains a list of scenes.
        One of these scenes is chosen as the active scene and
        will be loaded in a 3D viewer.
        It is dependent on the parameters and/or defaults
        in which viewer/version/mode.

        Parameters
        ----------
        sceneId: ObjectId
            The active scene in question.
            From the scene record we can find the edition and the project too.
        viewer: string or None
            The viewer to use.
        version: string or None
            The version to use.
        action: string or None
            The mode in which the viewer is to be used (`view` or `edit`).
        &#34;&#34;&#34;
        Content = self.Content
        sceneInfo = Content.getItem(&#34;scenes&#34;, _id=sceneId)
        projectId = sceneInfo.projectId
        editionId = sceneInfo.editionId
        return self.scenes(projectId, editionId, sceneId, viewer, version, action)

    def sceneInsert(self, projectId, editionId):
        &#34;&#34;&#34;Inserts a scene into an edition and shows the new scene.

        Parameters
        ----------
        projectId: ObjectId
            The project to which the scene belongs.
        editionId: ObjectId
            The edition to which the scene belongs.
        &#34;&#34;&#34;
        Messages = self.Messages
        Content = self.Content
        sceneId = Content.insertScene(projectId, editionId)
        if sceneId is None:
            Messages.warning(
                logmsg=&#34;Could not create new scene&#34;,
                msg=&#34;failed to create new scene&#34;,
            )
            newUrl = f&#34;/editions/{editionId}&#34;
        else:
            Messages.info(logmsg=f&#34;Created scene {sceneId}&#34;, msg=&#34;new scene created&#34;)
            newUrl = f&#34;/scenes/{sceneId}&#34;
        return redirectStatus(newUrl, sceneId is not None)

    def viewerFrame(self, sceneId, viewer, version, action):
        &#34;&#34;&#34;The page loaded in an iframe where a 3D viewer operates.

        Parameters
        ----------
        sceneId: ObjectId
            The scene that is shown.
        viewer: string or None
            The viewer to use.
        version: string or None
            The version to use.
        action: string or None
            The mode in which the viewer is to be used (`view` or `edit`).
        &#34;&#34;&#34;
        Content = self.Content
        Viewers = self.Viewers
        Auth = self.Auth

        sceneInfo = Content.getItem(&#34;scenes&#34;, _id=sceneId)
        sceneName = sceneInfo.name

        projectId = sceneInfo.projectId
        editionId = sceneInfo.editionId

        urlBase = f&#34;projects/{projectId}/editions/{editionId}/&#34;

        action = Auth.makeSafe(&#34;scenes&#34;, sceneId, action)

        viewerCode = (
            &#34;&#34;
            if action is None
            else Viewers.genHtml(urlBase, sceneName, viewer, version, action)
        )
        return template(&#34;viewer&#34;, viewerCode=viewerCode)

    def viewerResource(self, path):
        &#34;&#34;&#34;Components requested by viewers.

        This is the javascript code, the css, and other resources
        that are part of the 3D viewer software.

        Parameters
        ----------
        path: string
            Path on the file system under the viewers base directory
            where the resource resides.

        Returns
        -------
        response
            The response consists of the contents of the
            file plus headers derived from the path.
            If the file does not exists, a 404 is returned.
        &#34;&#34;&#34;
        Content = self.Content

        dataPath = Content.getViewerFile(path)
        return send(dataPath)

    def dataProjects(self, path, projectId=None, editionId=None):
        &#34;&#34;&#34;Data content requested directly from the file repository.

        This is

        * the material requested by the viewers:
          the scene json itself and additional resources,
          that are part of the user contributed content that is under
          control of the viewer: annotations, media, etc.
        * icons for the site, projects, and editions

        Parameters
        ----------
        path: string
            Path on the file system under the data directory
            where the resource resides.
            The path is relative to the project, and, if given, the edition.
        projectId: ObjectId, optional None
            The id of a project under which the resource is to be found.
            If None, it is site-wide material.
        editionId: ObjectId, optional None
            If not None, the name of an edition under which the resource
            is to be found.

        Returns
        -------
        response
            The response consists of the contents of the
            file plus headers derived from the path.
            If the file does not exists, a 404 is returned.
        &#34;&#34;&#34;
        Content = self.Content

        dataPath = Content.getData(path, projectId=projectId, editionId=editionId)
        return send(dataPath)

    def upload(self, table, recordId, field, path):
        Content = self.Content

        parts = path.rstrip(&#34;/&#34;).rsplit(&#34;/&#34;, 1)
        fileName = parts[-1]
        path = parts[0] if len(parts) == 2 else &#34;&#34;

        return Content.save(table, recordId, field, path, fileName)

    def authWebdav(self, projectId, editionId, path, action):
        &#34;&#34;&#34;Authorises a webdav request.

        When a viewer makes a WebDAV request to the server,
        that request is first checked here for authorisation.

        See `control.webdavapp.dispatchWebdav()`.

        Parameters
        ----------
        projectId: ObjectId
            The project in question.
        editionId: ObjectId
            The edition in question.
        path: string
            The path relative to the directory of the edition.
        action: string
            The operation that the WebDAV request wants to do on the data
            (`view` or `edit`).

        Returns
        -------
        boolean
            Whether the action is permitted on ths data by the current user.
        &#34;&#34;&#34;
        Messages = self.Messages
        Auth = self.Auth

        permitted = Auth.authorise(&#34;editions&#34;, recordId=editionId, action=action)
        if not permitted:
            User = Auth.myDetails()
            user = User.sub
            name = User.nickname
            Messages.info(
                logmsg=f&#34;WEBDav unauthorised by user {name} ({user})&#34;
                f&#34; on project {projectId} edition {editionId} path {path}&#34;
            )
        return permitted

    def remaining(self, path):
        &#34;&#34;&#34;When the url of the request is not recognized.

        Parameters
        ----------
        path: string
            The url (without leading /) that is not recognized.

        Returns
        -------
        response
            Either a redirect to the referred, for some
            recognized urls that correspond to not-yet
            implemented one. Or a 404 abort for all other
            cases.
        &#34;&#34;&#34;
        Messages = self.Messages

        def splitUrl(url):
            url = url.strip(&#34;/&#34;)
            parts = url.rsplit(&#34;/&#34;, 1)
            lastPart = parts[-1]
            firstPart = parts[0] if len(parts) &gt; 1 else &#34;&#34;
            firstPart = f&#34;/{firstPart}&#34;
            return (firstPart, lastPart)

        (firstPath, lastPath) = splitUrl(path)

        if lastPath in {&#34;read&#34;, &#34;update&#34;, &#34;delete&#34;}:
            Messages.warning(
                logmsg=f&#34;Not yet implemented /{lastPath}: /{path}&#34;,
                msg=f&#34;Not yet implemented: /{lastPath}&#34;,
            )
            ref = getReferrer()
            (firstRef, lastRef) = splitUrl(ref)
            back = firstRef if lastRef in {&#34;read&#34;, &#34;update&#34;, &#34;delete&#34;} else f&#34;/{ref}&#34;
            return redirectStatus(back, True)

        Messages.warning(logmsg=f&#34;Not found: /{path}&#34;)
        stop()

    def page(self, url, left=None, right=None):
        &#34;&#34;&#34;Workhorse function to get content on the page.

        Parameters
        ----------
        url: string
            Initial part of the url that triggered the page function.
            This part is used to make one of the tabs on the web page active.
        left: string, optional None
            Content for the left column of the page.
        right: string, optional None
            Content for the right column of the page.
        &#34;&#34;&#34;
        Settings = self.Settings
        # Messages = self.Messages
        Auth = self.Auth

        navigation = self.navigation(url)
        iconSite = self.putUpload(&#34;iconSite&#34;)
        (testLoginWidget, loginWidget) = Auth.wrapLogin()

        return template(
            &#34;index&#34;,
            banner=Settings.banner,
            versionInfo=Settings.versionInfo,
            navigation=navigation,
            materialLeft=left or &#34;&#34;,
            materialRight=right or &#34;&#34;,
            testLoginWidget=testLoginWidget,
            loginWidget=loginWidget,
            iconSite=iconSite,
        )

    def scenes(self, projectId, editionId, sceneId, viewer, version, action):
        &#34;&#34;&#34;Workhorse for `Pages.edition()` and `Pages.scene()`.

        The common part between the two functions mentioned.
        &#34;&#34;&#34;
        Content = self.Content
        Auth = self.Auth

        breadCrumb = self.breadCrumb(projectId)
        action = Auth.makeSafe(&#34;editions&#34;, editionId, action)
        sceneMaterial = (
            &#34;&#34;
            if action is None
            else Content.getScenes(
                projectId,
                editionId,
                sceneId=sceneId,
                viewer=viewer,
                version=version,
                action=action,
            )
        )
        left = (
            breadCrumb
            + self.putValues(&#34;title@4&#34;, projectId=projectId, editionId=editionId)
            + H.div(
                self.putUpload(&#34;model&#34;, projectId=projectId, editionId=editionId),
                cls=&#34;modelfile&#34;,
            )
            + H.h(4, &#34;Scenes&#34;)
            + sceneMaterial
        )
        right = self.putValues(
            &#34;abstract@5 + description@5 + provenance@5 + instructionalMethod@5&#34;,
            projectId=projectId,
            editionId=editionId,
        )
        return self.page(&#34;projects&#34;, left=left, right=right)

    def navigation(self, url):
        &#34;&#34;&#34;Generates the navigation controls.

        Especially the tab bar.

        Parameters
        ----------
        url: string
            Initial part of the url on the basis of which one of the
            tabs can be made active.

        Returns
        -------
        string
            The HTML of the navigation.
        &#34;&#34;&#34;

        TABS = (
            (&#34;home&#34;, &#34;Home&#34;, True),
            (&#34;about&#34;, &#34;About&#34;, True),
            (&#34;projects&#34;, &#34;3D Projects&#34;, True),
            (&#34;directory&#34;, &#34;3D Directory&#34;, False),
            (&#34;surpriseme&#34;, &#34;Surprise Me&#34;, True),
            (&#34;advancedsearch&#34;, &#34;Advanced Search&#34;, False),
        )

        search = H.span(
            [
                H.input(
                    &#34;search&#34;,
                    &#34;&#34;,
                    name=&#34;search&#34;,
                    placeholder=&#34;search item&#34;,
                    cls=&#34;button disabled&#34;,
                ),
                H.input(&#34;submit&#34;, &#34;Search&#34;, cls=&#34;button disabled&#34;),
            ],
            cls=&#34;search-bar&#34;,
        )

        divContent = []

        for (tab, label, enabled) in TABS:
            active = &#34;active&#34; if url == tab else &#34;&#34;
            if enabled:
                elem = &#34;a&#34;
                cls = active
                href = [f&#34;/{tab}&#34;]
            else:
                elem = &#34;span&#34;
                cls = &#34;disabled&#34;
                href = []
            fullCls = f&#34;button large {cls}&#34;
            divContent.append(H.elem(elem, label, *href, cls=fullCls))

        divContent.append(search)

        return H.div(divContent, cls=&#34;tabs&#34;)

    def breadCrumb(self, projectId):
        &#34;&#34;&#34;Makes a link to the landing page of a project.

        Parameters
        ----------
        projectId: ObjectId
            The project in question.
        &#34;&#34;&#34;
        Content = self.Content
        projectUrl = f&#34;/projects/{projectId}&#34;
        text = Content.getValue(&#34;title&#34;, projectId=projectId, bare=True)
        return H.p(
            [
                &#34;Project: &#34;,
                H.a(
                    [text, H.gt()],
                    projectUrl,
                    cls=&#34;button&#34;,
                    title=&#34;back to the project page&#34;,
                ),
            ]
        )

    def putValues(self, fieldSpecs, projectId=None, editionId=None):
        &#34;&#34;&#34;Puts several pieces of metadata on the web page.

        Parameters
        ----------
        fieldSpecs: string
            `,`-separated list of fieldSpecs
        projectId: ObjectId, optional None
            The project in question.
        editionId: ObjectId, optional None
            The edition in question.

        Returns
        -------
        string
            The join of the individual results of retrieving metadata value.
        &#34;&#34;&#34;
        Content = self.Content

        return H.content(
            Content.getValue(
                key,
                projectId=projectId,
                editionId=editionId,
                level=level,
            )
            or &#34;&#34;
            for (key, level) in (
                fieldSpec.strip().split(&#34;@&#34;, 1) for fieldSpec in fieldSpecs.split(&#34;+&#34;)
            )
        )

    def putUpload(self, key, projectId=None, editionId=None, cls=None):
        &#34;&#34;&#34;Puts a file upload control on a page.

        Parameters
        ----------
        key: string
            the key that identifies the kind of upload
        projectId: ObjectId, optional None
            The project in question.
        editionId: ObjectId, optional None
            The edition in question.
        cls: string, optional None
            An extra CSS class for the control

        Returns
        -------
        string
            A control that shows the file and possibly provides an upload/delete
            control for it.
        &#34;&#34;&#34;
        Content = self.Content

        return Content.getUpload(key, projectId=projectId, editionId=editionId) or &#34;&#34;</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="control.pages.Pages"><code class="flex name class">
<span>class <span class="ident">Pages</span></span>
<span>(</span><span>Settings, Viewers, Messages, Content, Auth)</span>
</code></dt>
<dd>
<div class="desc"><p>Making responses that can be displayed as web pages.</p>
<p>This class has methods that correspond to routes in the app,
for which they get the data (using <code><a title="control.content.Content" href="content.html#control.content.Content">Content</a></code>),
which gets then wrapped in HTML.</p>
<p>It is instantiated by a singleton object.</p>
<p>Most methods generate a response that contains the content of a complete
page. For those methods we do not document the return value.</p>
<p>Some methods return something different.
If so, it the return value will be documented.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>Settings</code></strong> :&ensp;<code><a title="control.generic.AttrDict" href="generic.html#control.generic.AttrDict">AttrDict</a></code></dt>
<dd>App-wide configuration data obtained from
<code><a title="control.config.Config.Settings" href="config.html#control.config.Config.Settings">Config.Settings</a></code>.</dd>
<dt><strong><code>Viewers</code></strong> :&ensp;<code>object</code></dt>
<dd>Singleton instance of <code><a title="control.viewers.Viewers" href="viewers.html#control.viewers.Viewers">Viewers</a></code>.</dd>
<dt><strong><code>Messages</code></strong> :&ensp;<code>object</code></dt>
<dd>Singleton instance of <code><a title="control.messages.Messages" href="messages.html#control.messages.Messages">Messages</a></code>.</dd>
<dt><strong><code>Mongo</code></strong> :&ensp;<code>object</code></dt>
<dd>Singleton instance of <code><a title="control.mongo.Mongo" href="mongo.html#control.mongo.Mongo">Mongo</a></code>.</dd>
<dt><strong><code>Content</code></strong> :&ensp;<code>object</code></dt>
<dd>Singleton instance of <code><a title="control.content.Content" href="content.html#control.content.Content">Content</a></code>.</dd>
<dt><strong><code>Auth</code></strong> :&ensp;<code>object</code></dt>
<dd>Singleton instance of <code><a title="control.auth.Auth" href="auth.html#control.auth.Auth">Auth</a></code>.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L5-L590" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class Pages:
    def __init__(self, Settings, Viewers, Messages, Content, Auth):
        &#34;&#34;&#34;Making responses that can be displayed as web pages.

        This class has methods that correspond to routes in the app,
        for which they get the data (using `control.content.Content`),
        which gets then wrapped in HTML.

        It is instantiated by a singleton object.

        Most methods generate a response that contains the content of a complete
        page. For those methods we do not document the return value.

        Some methods return something different.
        If so, it the return value will be documented.

        Parameters
        ----------
        Settings: `control.generic.AttrDict`
            App-wide configuration data obtained from
            `control.config.Config.Settings`.
        Viewers: object
            Singleton instance of `control.viewers.Viewers`.
        Messages: object
            Singleton instance of `control.messages.Messages`.
        Mongo: object
            Singleton instance of `control.mongo.Mongo`.
        Content: object
            Singleton instance of `control.content.Content`.
        Auth: object
            Singleton instance of `control.auth.Auth`.
        &#34;&#34;&#34;
        self.Settings = Settings
        self.Viewers = Viewers
        self.Messages = Messages
        Messages.debugAdd(self)
        self.Content = Content
        self.Auth = Auth

    def home(self):
        &#34;&#34;&#34;The site-wide home page.&#34;&#34;&#34;
        left = self.putValues(&#34;siteTitle@1 + abstract@2&#34;)
        return self.page(&#34;home&#34;, left=left)

    def about(self):
        &#34;&#34;&#34;The site-wide about page.&#34;&#34;&#34;
        left = self.putValues(&#34;siteTitle@1 + abstract@2&#34;)
        right = self.putValues(&#34;description@2 + provenance@2&#34;)
        return self.page(&#34;about&#34;, left=left, right=right)

    def surprise(self):
        &#34;&#34;&#34;The &#34;surprise me!&#34; page.&#34;&#34;&#34;
        Content = self.Content
        surpriseMe = Content.getSurprise()
        left = self.putValues(&#34;siteTitle@1&#34;)
        right = surpriseMe
        return self.page(&#34;surpriseme&#34;, left=left, right=right)

    def projects(self):
        &#34;&#34;&#34;The page with the list of projects.&#34;&#34;&#34;
        Content = self.Content
        projects = Content.getProjects()
        left = self.putValues(&#34;siteTitle@2&#34;) + projects
        return self.page(&#34;projects&#34;, left=left)

    def projectInsert(self):
        &#34;&#34;&#34;Inserts a project and shows the new project.&#34;&#34;&#34;
        Messages = self.Messages
        Content = self.Content
        projectId = Content.insertProject()
        if projectId is None:
            Messages.warning(
                logmsg=&#34;Could not create new project&#34;,
                msg=&#34;failed to create new project&#34;,
            )
            newUrl = &#34;/projects&#34;
        else:
            Messages.info(
                logmsg=f&#34;Created project {projectId}&#34;, msg=&#34;new project created&#34;
            )
            newUrl = f&#34;/projects/{projectId}&#34;
        return redirectStatus(newUrl, projectId is not None)

    def project(self, projectId):
        &#34;&#34;&#34;The landing page of a project.

        Parameters
        ----------
        projectId: ObjectId
            The project in question.
        &#34;&#34;&#34;
        Content = self.Content
        editions = Content.getEditions(projectId)
        left = self.putValues(&#34;title@3 + creator@0&#34;, projectId=projectId) + editions
        right = self.putValues(
            &#34;abstract@4 + description@4 + provenance@4 + instructionalMethod@4&#34;,
            projectId=projectId,
        )
        return self.page(&#34;projects&#34;, left=left, right=right)

    def editionInsert(self, projectId):
        &#34;&#34;&#34;Inserts an edition into a project and shows the new edition.

        Parameters
        ----------
        projectId: ObjectId
            The project to which the edition belongs.
        &#34;&#34;&#34;
        Messages = self.Messages
        Content = self.Content
        editionId = Content.insertEdition(projectId)
        if editionId is None:
            Messages.warning(
                logmsg=&#34;Could not create new edition&#34;,
                msg=&#34;failed to create new edition&#34;,
            )
            newUrl = f&#34;/projects/{projectId}&#34;
        else:
            Messages.info(
                logmsg=f&#34;Created edition {editionId}&#34;, msg=&#34;new edition created&#34;
            )
            newUrl = f&#34;/editions/{editionId}&#34;
        return redirectStatus(newUrl, editionId is not None)

    def edition(self, editionId):
        &#34;&#34;&#34;The landing page of an edition.

        This page contains a list of scenes.
        One of these scenes will be loaded in a 3D viewer.
        It is dependent on defaults which scene in which viewer/version/mode.

        Parameters
        ----------
        editionId: ObjectId
            The edition in question.
            From the edition record we can find the project too.
        &#34;&#34;&#34;
        Content = self.Content
        editionInfo = Content.getItem(&#34;editions&#34;, _id=editionId)
        projectId = editionInfo.projectId
        return self.scenes(projectId, editionId, None, None, None, None)

    def scene(self, sceneId, viewer, version, action):
        &#34;&#34;&#34;The landing page of an edition, but with a scene marked as active.

        This page contains a list of scenes.
        One of these scenes is chosen as the active scene and
        will be loaded in a 3D viewer.
        It is dependent on the parameters and/or defaults
        in which viewer/version/mode.

        Parameters
        ----------
        sceneId: ObjectId
            The active scene in question.
            From the scene record we can find the edition and the project too.
        viewer: string or None
            The viewer to use.
        version: string or None
            The version to use.
        action: string or None
            The mode in which the viewer is to be used (`view` or `edit`).
        &#34;&#34;&#34;
        Content = self.Content
        sceneInfo = Content.getItem(&#34;scenes&#34;, _id=sceneId)
        projectId = sceneInfo.projectId
        editionId = sceneInfo.editionId
        return self.scenes(projectId, editionId, sceneId, viewer, version, action)

    def sceneInsert(self, projectId, editionId):
        &#34;&#34;&#34;Inserts a scene into an edition and shows the new scene.

        Parameters
        ----------
        projectId: ObjectId
            The project to which the scene belongs.
        editionId: ObjectId
            The edition to which the scene belongs.
        &#34;&#34;&#34;
        Messages = self.Messages
        Content = self.Content
        sceneId = Content.insertScene(projectId, editionId)
        if sceneId is None:
            Messages.warning(
                logmsg=&#34;Could not create new scene&#34;,
                msg=&#34;failed to create new scene&#34;,
            )
            newUrl = f&#34;/editions/{editionId}&#34;
        else:
            Messages.info(logmsg=f&#34;Created scene {sceneId}&#34;, msg=&#34;new scene created&#34;)
            newUrl = f&#34;/scenes/{sceneId}&#34;
        return redirectStatus(newUrl, sceneId is not None)

    def viewerFrame(self, sceneId, viewer, version, action):
        &#34;&#34;&#34;The page loaded in an iframe where a 3D viewer operates.

        Parameters
        ----------
        sceneId: ObjectId
            The scene that is shown.
        viewer: string or None
            The viewer to use.
        version: string or None
            The version to use.
        action: string or None
            The mode in which the viewer is to be used (`view` or `edit`).
        &#34;&#34;&#34;
        Content = self.Content
        Viewers = self.Viewers
        Auth = self.Auth

        sceneInfo = Content.getItem(&#34;scenes&#34;, _id=sceneId)
        sceneName = sceneInfo.name

        projectId = sceneInfo.projectId
        editionId = sceneInfo.editionId

        urlBase = f&#34;projects/{projectId}/editions/{editionId}/&#34;

        action = Auth.makeSafe(&#34;scenes&#34;, sceneId, action)

        viewerCode = (
            &#34;&#34;
            if action is None
            else Viewers.genHtml(urlBase, sceneName, viewer, version, action)
        )
        return template(&#34;viewer&#34;, viewerCode=viewerCode)

    def viewerResource(self, path):
        &#34;&#34;&#34;Components requested by viewers.

        This is the javascript code, the css, and other resources
        that are part of the 3D viewer software.

        Parameters
        ----------
        path: string
            Path on the file system under the viewers base directory
            where the resource resides.

        Returns
        -------
        response
            The response consists of the contents of the
            file plus headers derived from the path.
            If the file does not exists, a 404 is returned.
        &#34;&#34;&#34;
        Content = self.Content

        dataPath = Content.getViewerFile(path)
        return send(dataPath)

    def dataProjects(self, path, projectId=None, editionId=None):
        &#34;&#34;&#34;Data content requested directly from the file repository.

        This is

        * the material requested by the viewers:
          the scene json itself and additional resources,
          that are part of the user contributed content that is under
          control of the viewer: annotations, media, etc.
        * icons for the site, projects, and editions

        Parameters
        ----------
        path: string
            Path on the file system under the data directory
            where the resource resides.
            The path is relative to the project, and, if given, the edition.
        projectId: ObjectId, optional None
            The id of a project under which the resource is to be found.
            If None, it is site-wide material.
        editionId: ObjectId, optional None
            If not None, the name of an edition under which the resource
            is to be found.

        Returns
        -------
        response
            The response consists of the contents of the
            file plus headers derived from the path.
            If the file does not exists, a 404 is returned.
        &#34;&#34;&#34;
        Content = self.Content

        dataPath = Content.getData(path, projectId=projectId, editionId=editionId)
        return send(dataPath)

    def upload(self, table, recordId, field, path):
        Content = self.Content

        parts = path.rstrip(&#34;/&#34;).rsplit(&#34;/&#34;, 1)
        fileName = parts[-1]
        path = parts[0] if len(parts) == 2 else &#34;&#34;

        return Content.save(table, recordId, field, path, fileName)

    def authWebdav(self, projectId, editionId, path, action):
        &#34;&#34;&#34;Authorises a webdav request.

        When a viewer makes a WebDAV request to the server,
        that request is first checked here for authorisation.

        See `control.webdavapp.dispatchWebdav()`.

        Parameters
        ----------
        projectId: ObjectId
            The project in question.
        editionId: ObjectId
            The edition in question.
        path: string
            The path relative to the directory of the edition.
        action: string
            The operation that the WebDAV request wants to do on the data
            (`view` or `edit`).

        Returns
        -------
        boolean
            Whether the action is permitted on ths data by the current user.
        &#34;&#34;&#34;
        Messages = self.Messages
        Auth = self.Auth

        permitted = Auth.authorise(&#34;editions&#34;, recordId=editionId, action=action)
        if not permitted:
            User = Auth.myDetails()
            user = User.sub
            name = User.nickname
            Messages.info(
                logmsg=f&#34;WEBDav unauthorised by user {name} ({user})&#34;
                f&#34; on project {projectId} edition {editionId} path {path}&#34;
            )
        return permitted

    def remaining(self, path):
        &#34;&#34;&#34;When the url of the request is not recognized.

        Parameters
        ----------
        path: string
            The url (without leading /) that is not recognized.

        Returns
        -------
        response
            Either a redirect to the referred, for some
            recognized urls that correspond to not-yet
            implemented one. Or a 404 abort for all other
            cases.
        &#34;&#34;&#34;
        Messages = self.Messages

        def splitUrl(url):
            url = url.strip(&#34;/&#34;)
            parts = url.rsplit(&#34;/&#34;, 1)
            lastPart = parts[-1]
            firstPart = parts[0] if len(parts) &gt; 1 else &#34;&#34;
            firstPart = f&#34;/{firstPart}&#34;
            return (firstPart, lastPart)

        (firstPath, lastPath) = splitUrl(path)

        if lastPath in {&#34;read&#34;, &#34;update&#34;, &#34;delete&#34;}:
            Messages.warning(
                logmsg=f&#34;Not yet implemented /{lastPath}: /{path}&#34;,
                msg=f&#34;Not yet implemented: /{lastPath}&#34;,
            )
            ref = getReferrer()
            (firstRef, lastRef) = splitUrl(ref)
            back = firstRef if lastRef in {&#34;read&#34;, &#34;update&#34;, &#34;delete&#34;} else f&#34;/{ref}&#34;
            return redirectStatus(back, True)

        Messages.warning(logmsg=f&#34;Not found: /{path}&#34;)
        stop()

    def page(self, url, left=None, right=None):
        &#34;&#34;&#34;Workhorse function to get content on the page.

        Parameters
        ----------
        url: string
            Initial part of the url that triggered the page function.
            This part is used to make one of the tabs on the web page active.
        left: string, optional None
            Content for the left column of the page.
        right: string, optional None
            Content for the right column of the page.
        &#34;&#34;&#34;
        Settings = self.Settings
        # Messages = self.Messages
        Auth = self.Auth

        navigation = self.navigation(url)
        iconSite = self.putUpload(&#34;iconSite&#34;)
        (testLoginWidget, loginWidget) = Auth.wrapLogin()

        return template(
            &#34;index&#34;,
            banner=Settings.banner,
            versionInfo=Settings.versionInfo,
            navigation=navigation,
            materialLeft=left or &#34;&#34;,
            materialRight=right or &#34;&#34;,
            testLoginWidget=testLoginWidget,
            loginWidget=loginWidget,
            iconSite=iconSite,
        )

    def scenes(self, projectId, editionId, sceneId, viewer, version, action):
        &#34;&#34;&#34;Workhorse for `Pages.edition()` and `Pages.scene()`.

        The common part between the two functions mentioned.
        &#34;&#34;&#34;
        Content = self.Content
        Auth = self.Auth

        breadCrumb = self.breadCrumb(projectId)
        action = Auth.makeSafe(&#34;editions&#34;, editionId, action)
        sceneMaterial = (
            &#34;&#34;
            if action is None
            else Content.getScenes(
                projectId,
                editionId,
                sceneId=sceneId,
                viewer=viewer,
                version=version,
                action=action,
            )
        )
        left = (
            breadCrumb
            + self.putValues(&#34;title@4&#34;, projectId=projectId, editionId=editionId)
            + H.div(
                self.putUpload(&#34;model&#34;, projectId=projectId, editionId=editionId),
                cls=&#34;modelfile&#34;,
            )
            + H.h(4, &#34;Scenes&#34;)
            + sceneMaterial
        )
        right = self.putValues(
            &#34;abstract@5 + description@5 + provenance@5 + instructionalMethod@5&#34;,
            projectId=projectId,
            editionId=editionId,
        )
        return self.page(&#34;projects&#34;, left=left, right=right)

    def navigation(self, url):
        &#34;&#34;&#34;Generates the navigation controls.

        Especially the tab bar.

        Parameters
        ----------
        url: string
            Initial part of the url on the basis of which one of the
            tabs can be made active.

        Returns
        -------
        string
            The HTML of the navigation.
        &#34;&#34;&#34;

        TABS = (
            (&#34;home&#34;, &#34;Home&#34;, True),
            (&#34;about&#34;, &#34;About&#34;, True),
            (&#34;projects&#34;, &#34;3D Projects&#34;, True),
            (&#34;directory&#34;, &#34;3D Directory&#34;, False),
            (&#34;surpriseme&#34;, &#34;Surprise Me&#34;, True),
            (&#34;advancedsearch&#34;, &#34;Advanced Search&#34;, False),
        )

        search = H.span(
            [
                H.input(
                    &#34;search&#34;,
                    &#34;&#34;,
                    name=&#34;search&#34;,
                    placeholder=&#34;search item&#34;,
                    cls=&#34;button disabled&#34;,
                ),
                H.input(&#34;submit&#34;, &#34;Search&#34;, cls=&#34;button disabled&#34;),
            ],
            cls=&#34;search-bar&#34;,
        )

        divContent = []

        for (tab, label, enabled) in TABS:
            active = &#34;active&#34; if url == tab else &#34;&#34;
            if enabled:
                elem = &#34;a&#34;
                cls = active
                href = [f&#34;/{tab}&#34;]
            else:
                elem = &#34;span&#34;
                cls = &#34;disabled&#34;
                href = []
            fullCls = f&#34;button large {cls}&#34;
            divContent.append(H.elem(elem, label, *href, cls=fullCls))

        divContent.append(search)

        return H.div(divContent, cls=&#34;tabs&#34;)

    def breadCrumb(self, projectId):
        &#34;&#34;&#34;Makes a link to the landing page of a project.

        Parameters
        ----------
        projectId: ObjectId
            The project in question.
        &#34;&#34;&#34;
        Content = self.Content
        projectUrl = f&#34;/projects/{projectId}&#34;
        text = Content.getValue(&#34;title&#34;, projectId=projectId, bare=True)
        return H.p(
            [
                &#34;Project: &#34;,
                H.a(
                    [text, H.gt()],
                    projectUrl,
                    cls=&#34;button&#34;,
                    title=&#34;back to the project page&#34;,
                ),
            ]
        )

    def putValues(self, fieldSpecs, projectId=None, editionId=None):
        &#34;&#34;&#34;Puts several pieces of metadata on the web page.

        Parameters
        ----------
        fieldSpecs: string
            `,`-separated list of fieldSpecs
        projectId: ObjectId, optional None
            The project in question.
        editionId: ObjectId, optional None
            The edition in question.

        Returns
        -------
        string
            The join of the individual results of retrieving metadata value.
        &#34;&#34;&#34;
        Content = self.Content

        return H.content(
            Content.getValue(
                key,
                projectId=projectId,
                editionId=editionId,
                level=level,
            )
            or &#34;&#34;
            for (key, level) in (
                fieldSpec.strip().split(&#34;@&#34;, 1) for fieldSpec in fieldSpecs.split(&#34;+&#34;)
            )
        )

    def putUpload(self, key, projectId=None, editionId=None, cls=None):
        &#34;&#34;&#34;Puts a file upload control on a page.

        Parameters
        ----------
        key: string
            the key that identifies the kind of upload
        projectId: ObjectId, optional None
            The project in question.
        editionId: ObjectId, optional None
            The edition in question.
        cls: string, optional None
            An extra CSS class for the control

        Returns
        -------
        string
            A control that shows the file and possibly provides an upload/delete
            control for it.
        &#34;&#34;&#34;
        Content = self.Content

        return Content.getUpload(key, projectId=projectId, editionId=editionId) or &#34;&#34;</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="control.pages.Pages.about"><code class="name flex">
<span>def <span class="ident">about</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>The site-wide about page.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L49-L53" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def about(self):
    &#34;&#34;&#34;The site-wide about page.&#34;&#34;&#34;
    left = self.putValues(&#34;siteTitle@1 + abstract@2&#34;)
    right = self.putValues(&#34;description@2 + provenance@2&#34;)
    return self.page(&#34;about&#34;, left=left, right=right)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.authWebdav"><code class="name flex">
<span>def <span class="ident">authWebdav</span></span>(<span>self, projectId, editionId, path, action)</span>
</code></dt>
<dd>
<div class="desc"><p>Authorises a webdav request.</p>
<p>When a viewer makes a WebDAV request to the server,
that request is first checked here for authorisation.</p>
<p>See <code><a title="control.webdavapp.dispatchWebdav" href="webdavapp.html#control.webdavapp.dispatchWebdav">dispatchWebdav()</a></code>.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>projectId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The project in question.</dd>
<dt><strong><code>editionId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The edition in question.</dd>
<dt><strong><code>path</code></strong> :&ensp;<code>string</code></dt>
<dd>The path relative to the directory of the edition.</dd>
<dt><strong><code>action</code></strong> :&ensp;<code>string</code></dt>
<dd>The operation that the WebDAV request wants to do on the data
(<code>view</code> or <code>edit</code>).</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>boolean</code></dt>
<dd>Whether the action is permitted on ths data by the current user.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L302-L339" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def authWebdav(self, projectId, editionId, path, action):
    &#34;&#34;&#34;Authorises a webdav request.

    When a viewer makes a WebDAV request to the server,
    that request is first checked here for authorisation.

    See `control.webdavapp.dispatchWebdav()`.

    Parameters
    ----------
    projectId: ObjectId
        The project in question.
    editionId: ObjectId
        The edition in question.
    path: string
        The path relative to the directory of the edition.
    action: string
        The operation that the WebDAV request wants to do on the data
        (`view` or `edit`).

    Returns
    -------
    boolean
        Whether the action is permitted on ths data by the current user.
    &#34;&#34;&#34;
    Messages = self.Messages
    Auth = self.Auth

    permitted = Auth.authorise(&#34;editions&#34;, recordId=editionId, action=action)
    if not permitted:
        User = Auth.myDetails()
        user = User.sub
        name = User.nickname
        Messages.info(
            logmsg=f&#34;WEBDav unauthorised by user {name} ({user})&#34;
            f&#34; on project {projectId} edition {editionId} path {path}&#34;
        )
    return permitted</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.breadCrumb"><code class="name flex">
<span>def <span class="ident">breadCrumb</span></span>(<span>self, projectId)</span>
</code></dt>
<dd>
<div class="desc"><p>Makes a link to the landing page of a project.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>projectId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The project in question.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L513-L534" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def breadCrumb(self, projectId):
    &#34;&#34;&#34;Makes a link to the landing page of a project.

    Parameters
    ----------
    projectId: ObjectId
        The project in question.
    &#34;&#34;&#34;
    Content = self.Content
    projectUrl = f&#34;/projects/{projectId}&#34;
    text = Content.getValue(&#34;title&#34;, projectId=projectId, bare=True)
    return H.p(
        [
            &#34;Project: &#34;,
            H.a(
                [text, H.gt()],
                projectUrl,
                cls=&#34;button&#34;,
                title=&#34;back to the project page&#34;,
            ),
        ]
    )</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.dataProjects"><code class="name flex">
<span>def <span class="ident">dataProjects</span></span>(<span>self, path, projectId=None, editionId=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Data content requested directly from the file repository.</p>
<p>This is</p>
<ul>
<li>the material requested by the viewers:
the scene json itself and additional resources,
that are part of the user contributed content that is under
control of the viewer: annotations, media, etc.</li>
<li>icons for the site, projects, and editions</li>
</ul>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>path</code></strong> :&ensp;<code>string</code></dt>
<dd>Path on the file system under the data directory
where the resource resides.
The path is relative to the project, and, if given, the edition.</dd>
<dt><strong><code>projectId</code></strong> :&ensp;<code>ObjectId</code>, optional <code>None</code></dt>
<dd>The id of a project under which the resource is to be found.
If None, it is site-wide material.</dd>
<dt><strong><code>editionId</code></strong> :&ensp;<code>ObjectId</code>, optional <code>None</code></dt>
<dd>If not None, the name of an edition under which the resource
is to be found.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>response</code></dt>
<dd>The response consists of the contents of the
file plus headers derived from the path.
If the file does not exists, a 404 is returned.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L257-L291" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def dataProjects(self, path, projectId=None, editionId=None):
    &#34;&#34;&#34;Data content requested directly from the file repository.

    This is

    * the material requested by the viewers:
      the scene json itself and additional resources,
      that are part of the user contributed content that is under
      control of the viewer: annotations, media, etc.
    * icons for the site, projects, and editions

    Parameters
    ----------
    path: string
        Path on the file system under the data directory
        where the resource resides.
        The path is relative to the project, and, if given, the edition.
    projectId: ObjectId, optional None
        The id of a project under which the resource is to be found.
        If None, it is site-wide material.
    editionId: ObjectId, optional None
        If not None, the name of an edition under which the resource
        is to be found.

    Returns
    -------
    response
        The response consists of the contents of the
        file plus headers derived from the path.
        If the file does not exists, a 404 is returned.
    &#34;&#34;&#34;
    Content = self.Content

    dataPath = Content.getData(path, projectId=projectId, editionId=editionId)
    return send(dataPath)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.edition"><code class="name flex">
<span>def <span class="ident">edition</span></span>(<span>self, editionId)</span>
</code></dt>
<dd>
<div class="desc"><p>The landing page of an edition.</p>
<p>This page contains a list of scenes.
One of these scenes will be loaded in a 3D viewer.
It is dependent on defaults which scene in which viewer/version/mode.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>editionId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The edition in question.
From the edition record we can find the project too.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L129-L145" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def edition(self, editionId):
    &#34;&#34;&#34;The landing page of an edition.

    This page contains a list of scenes.
    One of these scenes will be loaded in a 3D viewer.
    It is dependent on defaults which scene in which viewer/version/mode.

    Parameters
    ----------
    editionId: ObjectId
        The edition in question.
        From the edition record we can find the project too.
    &#34;&#34;&#34;
    Content = self.Content
    editionInfo = Content.getItem(&#34;editions&#34;, _id=editionId)
    projectId = editionInfo.projectId
    return self.scenes(projectId, editionId, None, None, None, None)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.editionInsert"><code class="name flex">
<span>def <span class="ident">editionInsert</span></span>(<span>self, projectId)</span>
</code></dt>
<dd>
<div class="desc"><p>Inserts an edition into a project and shows the new edition.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>projectId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The project to which the edition belongs.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L105-L127" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def editionInsert(self, projectId):
    &#34;&#34;&#34;Inserts an edition into a project and shows the new edition.

    Parameters
    ----------
    projectId: ObjectId
        The project to which the edition belongs.
    &#34;&#34;&#34;
    Messages = self.Messages
    Content = self.Content
    editionId = Content.insertEdition(projectId)
    if editionId is None:
        Messages.warning(
            logmsg=&#34;Could not create new edition&#34;,
            msg=&#34;failed to create new edition&#34;,
        )
        newUrl = f&#34;/projects/{projectId}&#34;
    else:
        Messages.info(
            logmsg=f&#34;Created edition {editionId}&#34;, msg=&#34;new edition created&#34;
        )
        newUrl = f&#34;/editions/{editionId}&#34;
    return redirectStatus(newUrl, editionId is not None)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.home"><code class="name flex">
<span>def <span class="ident">home</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>The site-wide home page.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L44-L47" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def home(self):
    &#34;&#34;&#34;The site-wide home page.&#34;&#34;&#34;
    left = self.putValues(&#34;siteTitle@1 + abstract@2&#34;)
    return self.page(&#34;home&#34;, left=left)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.navigation"><code class="name flex">
<span>def <span class="ident">navigation</span></span>(<span>self, url)</span>
</code></dt>
<dd>
<div class="desc"><p>Generates the navigation controls.</p>
<p>Especially the tab bar.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>url</code></strong> :&ensp;<code>string</code></dt>
<dd>Initial part of the url on the basis of which one of the
tabs can be made active.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>string</code></dt>
<dd>The HTML of the navigation.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L454-L511" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def navigation(self, url):
    &#34;&#34;&#34;Generates the navigation controls.

    Especially the tab bar.

    Parameters
    ----------
    url: string
        Initial part of the url on the basis of which one of the
        tabs can be made active.

    Returns
    -------
    string
        The HTML of the navigation.
    &#34;&#34;&#34;

    TABS = (
        (&#34;home&#34;, &#34;Home&#34;, True),
        (&#34;about&#34;, &#34;About&#34;, True),
        (&#34;projects&#34;, &#34;3D Projects&#34;, True),
        (&#34;directory&#34;, &#34;3D Directory&#34;, False),
        (&#34;surpriseme&#34;, &#34;Surprise Me&#34;, True),
        (&#34;advancedsearch&#34;, &#34;Advanced Search&#34;, False),
    )

    search = H.span(
        [
            H.input(
                &#34;search&#34;,
                &#34;&#34;,
                name=&#34;search&#34;,
                placeholder=&#34;search item&#34;,
                cls=&#34;button disabled&#34;,
            ),
            H.input(&#34;submit&#34;, &#34;Search&#34;, cls=&#34;button disabled&#34;),
        ],
        cls=&#34;search-bar&#34;,
    )

    divContent = []

    for (tab, label, enabled) in TABS:
        active = &#34;active&#34; if url == tab else &#34;&#34;
        if enabled:
            elem = &#34;a&#34;
            cls = active
            href = [f&#34;/{tab}&#34;]
        else:
            elem = &#34;span&#34;
            cls = &#34;disabled&#34;
            href = []
        fullCls = f&#34;button large {cls}&#34;
        divContent.append(H.elem(elem, label, *href, cls=fullCls))

    divContent.append(search)

    return H.div(divContent, cls=&#34;tabs&#34;)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.page"><code class="name flex">
<span>def <span class="ident">page</span></span>(<span>self, url, left=None, right=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Workhorse function to get content on the page.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>url</code></strong> :&ensp;<code>string</code></dt>
<dd>Initial part of the url that triggered the page function.
This part is used to make one of the tabs on the web page active.</dd>
<dt><strong><code>left</code></strong> :&ensp;<code>string</code>, optional <code>None</code></dt>
<dd>Content for the left column of the page.</dd>
<dt><strong><code>right</code></strong> :&ensp;<code>string</code>, optional <code>None</code></dt>
<dd>Content for the right column of the page.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L382-L413" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def page(self, url, left=None, right=None):
    &#34;&#34;&#34;Workhorse function to get content on the page.

    Parameters
    ----------
    url: string
        Initial part of the url that triggered the page function.
        This part is used to make one of the tabs on the web page active.
    left: string, optional None
        Content for the left column of the page.
    right: string, optional None
        Content for the right column of the page.
    &#34;&#34;&#34;
    Settings = self.Settings
    # Messages = self.Messages
    Auth = self.Auth

    navigation = self.navigation(url)
    iconSite = self.putUpload(&#34;iconSite&#34;)
    (testLoginWidget, loginWidget) = Auth.wrapLogin()

    return template(
        &#34;index&#34;,
        banner=Settings.banner,
        versionInfo=Settings.versionInfo,
        navigation=navigation,
        materialLeft=left or &#34;&#34;,
        materialRight=right or &#34;&#34;,
        testLoginWidget=testLoginWidget,
        loginWidget=loginWidget,
        iconSite=iconSite,
    )</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.project"><code class="name flex">
<span>def <span class="ident">project</span></span>(<span>self, projectId)</span>
</code></dt>
<dd>
<div class="desc"><p>The landing page of a project.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>projectId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The project in question.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L88-L103" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def project(self, projectId):
    &#34;&#34;&#34;The landing page of a project.

    Parameters
    ----------
    projectId: ObjectId
        The project in question.
    &#34;&#34;&#34;
    Content = self.Content
    editions = Content.getEditions(projectId)
    left = self.putValues(&#34;title@3 + creator@0&#34;, projectId=projectId) + editions
    right = self.putValues(
        &#34;abstract@4 + description@4 + provenance@4 + instructionalMethod@4&#34;,
        projectId=projectId,
    )
    return self.page(&#34;projects&#34;, left=left, right=right)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.projectInsert"><code class="name flex">
<span>def <span class="ident">projectInsert</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Inserts a project and shows the new project.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L70-L86" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def projectInsert(self):
    &#34;&#34;&#34;Inserts a project and shows the new project.&#34;&#34;&#34;
    Messages = self.Messages
    Content = self.Content
    projectId = Content.insertProject()
    if projectId is None:
        Messages.warning(
            logmsg=&#34;Could not create new project&#34;,
            msg=&#34;failed to create new project&#34;,
        )
        newUrl = &#34;/projects&#34;
    else:
        Messages.info(
            logmsg=f&#34;Created project {projectId}&#34;, msg=&#34;new project created&#34;
        )
        newUrl = f&#34;/projects/{projectId}&#34;
    return redirectStatus(newUrl, projectId is not None)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.projects"><code class="name flex">
<span>def <span class="ident">projects</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>The page with the list of projects.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L63-L68" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def projects(self):
    &#34;&#34;&#34;The page with the list of projects.&#34;&#34;&#34;
    Content = self.Content
    projects = Content.getProjects()
    left = self.putValues(&#34;siteTitle@2&#34;) + projects
    return self.page(&#34;projects&#34;, left=left)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.putUpload"><code class="name flex">
<span>def <span class="ident">putUpload</span></span>(<span>self, key, projectId=None, editionId=None, cls=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Puts a file upload control on a page.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>key</code></strong> :&ensp;<code>string</code></dt>
<dd>the key that identifies the kind of upload</dd>
<dt><strong><code>projectId</code></strong> :&ensp;<code>ObjectId</code>, optional <code>None</code></dt>
<dd>The project in question.</dd>
<dt><strong><code>editionId</code></strong> :&ensp;<code>ObjectId</code>, optional <code>None</code></dt>
<dd>The edition in question.</dd>
<dt><strong><code>cls</code></strong> :&ensp;<code>string</code>, optional <code>None</code></dt>
<dd>An extra CSS class for the control</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>string</code></dt>
<dd>A control that shows the file and possibly provides an upload/delete
control for it.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L568-L590" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def putUpload(self, key, projectId=None, editionId=None, cls=None):
    &#34;&#34;&#34;Puts a file upload control on a page.

    Parameters
    ----------
    key: string
        the key that identifies the kind of upload
    projectId: ObjectId, optional None
        The project in question.
    editionId: ObjectId, optional None
        The edition in question.
    cls: string, optional None
        An extra CSS class for the control

    Returns
    -------
    string
        A control that shows the file and possibly provides an upload/delete
        control for it.
    &#34;&#34;&#34;
    Content = self.Content

    return Content.getUpload(key, projectId=projectId, editionId=editionId) or &#34;&#34;</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.putValues"><code class="name flex">
<span>def <span class="ident">putValues</span></span>(<span>self, fieldSpecs, projectId=None, editionId=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Puts several pieces of metadata on the web page.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>fieldSpecs</code></strong> :&ensp;<code>string</code></dt>
<dd><code>,</code>-separated list of fieldSpecs</dd>
<dt><strong><code>projectId</code></strong> :&ensp;<code>ObjectId</code>, optional <code>None</code></dt>
<dd>The project in question.</dd>
<dt><strong><code>editionId</code></strong> :&ensp;<code>ObjectId</code>, optional <code>None</code></dt>
<dd>The edition in question.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>string</code></dt>
<dd>The join of the individual results of retrieving metadata value.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L536-L566" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def putValues(self, fieldSpecs, projectId=None, editionId=None):
    &#34;&#34;&#34;Puts several pieces of metadata on the web page.

    Parameters
    ----------
    fieldSpecs: string
        `,`-separated list of fieldSpecs
    projectId: ObjectId, optional None
        The project in question.
    editionId: ObjectId, optional None
        The edition in question.

    Returns
    -------
    string
        The join of the individual results of retrieving metadata value.
    &#34;&#34;&#34;
    Content = self.Content

    return H.content(
        Content.getValue(
            key,
            projectId=projectId,
            editionId=editionId,
            level=level,
        )
        or &#34;&#34;
        for (key, level) in (
            fieldSpec.strip().split(&#34;@&#34;, 1) for fieldSpec in fieldSpecs.split(&#34;+&#34;)
        )
    )</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.remaining"><code class="name flex">
<span>def <span class="ident">remaining</span></span>(<span>self, path)</span>
</code></dt>
<dd>
<div class="desc"><p>When the url of the request is not recognized.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>path</code></strong> :&ensp;<code>string</code></dt>
<dd>The url (without leading /) that is not recognized.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>response</code></dt>
<dd>Either a redirect to the referred, for some
recognized urls that correspond to not-yet
implemented one. Or a 404 abort for all other
cases.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L341-L380" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def remaining(self, path):
    &#34;&#34;&#34;When the url of the request is not recognized.

    Parameters
    ----------
    path: string
        The url (without leading /) that is not recognized.

    Returns
    -------
    response
        Either a redirect to the referred, for some
        recognized urls that correspond to not-yet
        implemented one. Or a 404 abort for all other
        cases.
    &#34;&#34;&#34;
    Messages = self.Messages

    def splitUrl(url):
        url = url.strip(&#34;/&#34;)
        parts = url.rsplit(&#34;/&#34;, 1)
        lastPart = parts[-1]
        firstPart = parts[0] if len(parts) &gt; 1 else &#34;&#34;
        firstPart = f&#34;/{firstPart}&#34;
        return (firstPart, lastPart)

    (firstPath, lastPath) = splitUrl(path)

    if lastPath in {&#34;read&#34;, &#34;update&#34;, &#34;delete&#34;}:
        Messages.warning(
            logmsg=f&#34;Not yet implemented /{lastPath}: /{path}&#34;,
            msg=f&#34;Not yet implemented: /{lastPath}&#34;,
        )
        ref = getReferrer()
        (firstRef, lastRef) = splitUrl(ref)
        back = firstRef if lastRef in {&#34;read&#34;, &#34;update&#34;, &#34;delete&#34;} else f&#34;/{ref}&#34;
        return redirectStatus(back, True)

    Messages.warning(logmsg=f&#34;Not found: /{path}&#34;)
    stop()</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.scene"><code class="name flex">
<span>def <span class="ident">scene</span></span>(<span>self, sceneId, viewer, version, action)</span>
</code></dt>
<dd>
<div class="desc"><p>The landing page of an edition, but with a scene marked as active.</p>
<p>This page contains a list of scenes.
One of these scenes is chosen as the active scene and
will be loaded in a 3D viewer.
It is dependent on the parameters and/or defaults
in which viewer/version/mode.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>sceneId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The active scene in question.
From the scene record we can find the edition and the project too.</dd>
<dt><strong><code>viewer</code></strong> :&ensp;<code>string</code> or <code>None</code></dt>
<dd>The viewer to use.</dd>
<dt><strong><code>version</code></strong> :&ensp;<code>string</code> or <code>None</code></dt>
<dd>The version to use.</dd>
<dt><strong><code>action</code></strong> :&ensp;<code>string</code> or <code>None</code></dt>
<dd>The mode in which the viewer is to be used (<code>view</code> or <code>edit</code>).</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L147-L172" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def scene(self, sceneId, viewer, version, action):
    &#34;&#34;&#34;The landing page of an edition, but with a scene marked as active.

    This page contains a list of scenes.
    One of these scenes is chosen as the active scene and
    will be loaded in a 3D viewer.
    It is dependent on the parameters and/or defaults
    in which viewer/version/mode.

    Parameters
    ----------
    sceneId: ObjectId
        The active scene in question.
        From the scene record we can find the edition and the project too.
    viewer: string or None
        The viewer to use.
    version: string or None
        The version to use.
    action: string or None
        The mode in which the viewer is to be used (`view` or `edit`).
    &#34;&#34;&#34;
    Content = self.Content
    sceneInfo = Content.getItem(&#34;scenes&#34;, _id=sceneId)
    projectId = sceneInfo.projectId
    editionId = sceneInfo.editionId
    return self.scenes(projectId, editionId, sceneId, viewer, version, action)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.sceneInsert"><code class="name flex">
<span>def <span class="ident">sceneInsert</span></span>(<span>self, projectId, editionId)</span>
</code></dt>
<dd>
<div class="desc"><p>Inserts a scene into an edition and shows the new scene.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>projectId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The project to which the scene belongs.</dd>
<dt><strong><code>editionId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The edition to which the scene belongs.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L174-L196" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def sceneInsert(self, projectId, editionId):
    &#34;&#34;&#34;Inserts a scene into an edition and shows the new scene.

    Parameters
    ----------
    projectId: ObjectId
        The project to which the scene belongs.
    editionId: ObjectId
        The edition to which the scene belongs.
    &#34;&#34;&#34;
    Messages = self.Messages
    Content = self.Content
    sceneId = Content.insertScene(projectId, editionId)
    if sceneId is None:
        Messages.warning(
            logmsg=&#34;Could not create new scene&#34;,
            msg=&#34;failed to create new scene&#34;,
        )
        newUrl = f&#34;/editions/{editionId}&#34;
    else:
        Messages.info(logmsg=f&#34;Created scene {sceneId}&#34;, msg=&#34;new scene created&#34;)
        newUrl = f&#34;/scenes/{sceneId}&#34;
    return redirectStatus(newUrl, sceneId is not None)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.scenes"><code class="name flex">
<span>def <span class="ident">scenes</span></span>(<span>self, projectId, editionId, sceneId, viewer, version, action)</span>
</code></dt>
<dd>
<div class="desc"><p>Workhorse for <code><a title="control.pages.Pages.edition" href="#control.pages.Pages.edition">Pages.edition()</a></code> and <code><a title="control.pages.Pages.scene" href="#control.pages.Pages.scene">Pages.scene()</a></code>.</p>
<p>The common part between the two functions mentioned.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L415-L452" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def scenes(self, projectId, editionId, sceneId, viewer, version, action):
    &#34;&#34;&#34;Workhorse for `Pages.edition()` and `Pages.scene()`.

    The common part between the two functions mentioned.
    &#34;&#34;&#34;
    Content = self.Content
    Auth = self.Auth

    breadCrumb = self.breadCrumb(projectId)
    action = Auth.makeSafe(&#34;editions&#34;, editionId, action)
    sceneMaterial = (
        &#34;&#34;
        if action is None
        else Content.getScenes(
            projectId,
            editionId,
            sceneId=sceneId,
            viewer=viewer,
            version=version,
            action=action,
        )
    )
    left = (
        breadCrumb
        + self.putValues(&#34;title@4&#34;, projectId=projectId, editionId=editionId)
        + H.div(
            self.putUpload(&#34;model&#34;, projectId=projectId, editionId=editionId),
            cls=&#34;modelfile&#34;,
        )
        + H.h(4, &#34;Scenes&#34;)
        + sceneMaterial
    )
    right = self.putValues(
        &#34;abstract@5 + description@5 + provenance@5 + instructionalMethod@5&#34;,
        projectId=projectId,
        editionId=editionId,
    )
    return self.page(&#34;projects&#34;, left=left, right=right)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.surprise"><code class="name flex">
<span>def <span class="ident">surprise</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>The "surprise me!" page.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L55-L61" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def surprise(self):
    &#34;&#34;&#34;The &#34;surprise me!&#34; page.&#34;&#34;&#34;
    Content = self.Content
    surpriseMe = Content.getSurprise()
    left = self.putValues(&#34;siteTitle@1&#34;)
    right = surpriseMe
    return self.page(&#34;surpriseme&#34;, left=left, right=right)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.upload"><code class="name flex">
<span>def <span class="ident">upload</span></span>(<span>self, table, recordId, field, path)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L293-L300" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def upload(self, table, recordId, field, path):
    Content = self.Content

    parts = path.rstrip(&#34;/&#34;).rsplit(&#34;/&#34;, 1)
    fileName = parts[-1]
    path = parts[0] if len(parts) == 2 else &#34;&#34;

    return Content.save(table, recordId, field, path, fileName)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.viewerFrame"><code class="name flex">
<span>def <span class="ident">viewerFrame</span></span>(<span>self, sceneId, viewer, version, action)</span>
</code></dt>
<dd>
<div class="desc"><p>The page loaded in an iframe where a 3D viewer operates.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>sceneId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The scene that is shown.</dd>
<dt><strong><code>viewer</code></strong> :&ensp;<code>string</code> or <code>None</code></dt>
<dd>The viewer to use.</dd>
<dt><strong><code>version</code></strong> :&ensp;<code>string</code> or <code>None</code></dt>
<dd>The version to use.</dd>
<dt><strong><code>action</code></strong> :&ensp;<code>string</code> or <code>None</code></dt>
<dd>The mode in which the viewer is to be used (<code>view</code> or <code>edit</code>).</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L198-L231" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def viewerFrame(self, sceneId, viewer, version, action):
    &#34;&#34;&#34;The page loaded in an iframe where a 3D viewer operates.

    Parameters
    ----------
    sceneId: ObjectId
        The scene that is shown.
    viewer: string or None
        The viewer to use.
    version: string or None
        The version to use.
    action: string or None
        The mode in which the viewer is to be used (`view` or `edit`).
    &#34;&#34;&#34;
    Content = self.Content
    Viewers = self.Viewers
    Auth = self.Auth

    sceneInfo = Content.getItem(&#34;scenes&#34;, _id=sceneId)
    sceneName = sceneInfo.name

    projectId = sceneInfo.projectId
    editionId = sceneInfo.editionId

    urlBase = f&#34;projects/{projectId}/editions/{editionId}/&#34;

    action = Auth.makeSafe(&#34;scenes&#34;, sceneId, action)

    viewerCode = (
        &#34;&#34;
        if action is None
        else Viewers.genHtml(urlBase, sceneName, viewer, version, action)
    )
    return template(&#34;viewer&#34;, viewerCode=viewerCode)</code></pre>
</details>
</dd>
<dt id="control.pages.Pages.viewerResource"><code class="name flex">
<span>def <span class="ident">viewerResource</span></span>(<span>self, path)</span>
</code></dt>
<dd>
<div class="desc"><p>Components requested by viewers.</p>
<p>This is the javascript code, the css, and other resources
that are part of the 3D viewer software.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>path</code></strong> :&ensp;<code>string</code></dt>
<dd>Path on the file system under the viewers base directory
where the resource resides.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>response</code></dt>
<dd>The response consists of the contents of the
file plus headers derived from the path.
If the file does not exists, a 404 is returned.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/43bd2e150961ad81f2af6575b1c8f269a7e20738/src/pure3d/control/pages.py#L233-L255" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def viewerResource(self, path):
    &#34;&#34;&#34;Components requested by viewers.

    This is the javascript code, the css, and other resources
    that are part of the 3D viewer software.

    Parameters
    ----------
    path: string
        Path on the file system under the viewers base directory
        where the resource resides.

    Returns
    -------
    response
        The response consists of the contents of the
        file plus headers derived from the path.
        If the file does not exists, a 404 is returned.
    &#34;&#34;&#34;
    Content = self.Content

    dataPath = Content.getViewerFile(path)
    return send(dataPath)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<p><a href="https://github.com/CLARIAH/pure3dx" title="GitHub repo">GitHub</a></p>
<form>
<input id="lunr-search" name="q" placeholder="🔎 Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="control" href="index.html">control</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="control.pages.Pages" href="#control.pages.Pages">Pages</a></code></h4>
<ul class="two-column">
<li><code><a title="control.pages.Pages.about" href="#control.pages.Pages.about">about</a></code></li>
<li><code><a title="control.pages.Pages.authWebdav" href="#control.pages.Pages.authWebdav">authWebdav</a></code></li>
<li><code><a title="control.pages.Pages.breadCrumb" href="#control.pages.Pages.breadCrumb">breadCrumb</a></code></li>
<li><code><a title="control.pages.Pages.dataProjects" href="#control.pages.Pages.dataProjects">dataProjects</a></code></li>
<li><code><a title="control.pages.Pages.edition" href="#control.pages.Pages.edition">edition</a></code></li>
<li><code><a title="control.pages.Pages.editionInsert" href="#control.pages.Pages.editionInsert">editionInsert</a></code></li>
<li><code><a title="control.pages.Pages.home" href="#control.pages.Pages.home">home</a></code></li>
<li><code><a title="control.pages.Pages.navigation" href="#control.pages.Pages.navigation">navigation</a></code></li>
<li><code><a title="control.pages.Pages.page" href="#control.pages.Pages.page">page</a></code></li>
<li><code><a title="control.pages.Pages.project" href="#control.pages.Pages.project">project</a></code></li>
<li><code><a title="control.pages.Pages.projectInsert" href="#control.pages.Pages.projectInsert">projectInsert</a></code></li>
<li><code><a title="control.pages.Pages.projects" href="#control.pages.Pages.projects">projects</a></code></li>
<li><code><a title="control.pages.Pages.putUpload" href="#control.pages.Pages.putUpload">putUpload</a></code></li>
<li><code><a title="control.pages.Pages.putValues" href="#control.pages.Pages.putValues">putValues</a></code></li>
<li><code><a title="control.pages.Pages.remaining" href="#control.pages.Pages.remaining">remaining</a></code></li>
<li><code><a title="control.pages.Pages.scene" href="#control.pages.Pages.scene">scene</a></code></li>
<li><code><a title="control.pages.Pages.sceneInsert" href="#control.pages.Pages.sceneInsert">sceneInsert</a></code></li>
<li><code><a title="control.pages.Pages.scenes" href="#control.pages.Pages.scenes">scenes</a></code></li>
<li><code><a title="control.pages.Pages.surprise" href="#control.pages.Pages.surprise">surprise</a></code></li>
<li><code><a title="control.pages.Pages.upload" href="#control.pages.Pages.upload">upload</a></code></li>
<li><code><a title="control.pages.Pages.viewerFrame" href="#control.pages.Pages.viewerFrame">viewerFrame</a></code></li>
<li><code><a title="control.pages.Pages.viewerResource" href="#control.pages.Pages.viewerResource">viewerResource</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<a href="https://pure.knaw.nl/portal/en/persons/dirk-roorda">Dirk Roorda</a>
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>