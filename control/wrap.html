<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.11.1" />
<title>control.wrap API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>control.wrap</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/99a827eec565f9f7bf0633f62d3c060d35dd93dc/src/control/wrap.py#L1-L382" class="git-link">Browse git</a>
</summary>
<pre><code class="python"># from .generic import AttrDict


class Wrap:
    def __init__(self, Settings, Messages, Viewers):
        &#34;&#34;&#34;Wrap concepts into HTML.

        This class knows how to wrap several higher-level concepts into HTML,
        such as projects, editions and users, depending on specific
        purposes, such as showing widgets to manage projects and editions.

        It is instantiated by a singleton object.

        Parameters
        ----------
        Settings: AttrDict
            App-wide configuration data obtained from
            `control.config.Config.Settings`.
        Messages: object
            Singleton instance of `control.messages.Messages`.
        Viewers: object
            Singleton instance of `control.viewers.Viewers`.
        &#34;&#34;&#34;
        self.Settings = Settings
        self.Messages = Messages
        self.Viewers = Viewers
        Messages.debugAdd(self)

    def addAuth(self, Auth):
        &#34;&#34;&#34;Give this object a handle to the Auth object.

        The Wrap and Auth objects need each other, so one of them must
        be given the handle to the other after initialization.
        &#34;&#34;&#34;
        self.Auth = Auth

    def addContent(self, Content):
        &#34;&#34;&#34;Give this object a handle to the Content object.

        The Wrap and Content objects need each other, so one of them must
        be given the handle to the other after initialization.
        &#34;&#34;&#34;
        self.Content = Content

    def projectsMain(self, site, projects):
        &#34;&#34;&#34;Wrap the list of projects for the main display.

        Parameters
        ----------
        site: AttrDict
            The record that corresponds to the site as a whole.
            It acts as a master record of the projects.
        projects: list of AttrDict
            The project records.

        Returns
        -------
        string
            The HTML of the project list
        &#34;&#34;&#34;
        Settings = self.Settings
        H = Settings.H
        representations = Settings.representations
        css = Settings.css
        Auth = self.Auth
        Content = self.Content

        wrapped = []
        wrapped.append(
            H.p(
                self.contentButton(
                    &#34;site&#34;, site, &#34;create&#34;, insertTable=&#34;project&#34;, text=&#34;New project&#34;
                )
            )
        )

        for project in projects:
            projectId = project._id
            permitted = Auth.authorise(&#34;project&#34;, project, action=&#34;read&#34;)

            if not permitted:
                continue

            title = project.title

            if not title:
                title = H(&#34;no title&#34;)

            stat = project.isVisible or False
            status = representations.isVisible[stat]
            statusCls = css.isVisible[stat]

            projectUrl = f&#34;/project/{projectId}&#34;
            button = self.contentButton(
                &#34;project&#34;, project, &#34;delete&#34;, confirm=True, text=&#34;Delete project&#34;
            )
            visual = Content.getUpload(project, &#34;iconProject&#34;)
            caption = self.getCaption(
                visual, title, status, statusCls, button, projectUrl
            )

            wrapped.append(caption)

        return H.content(*wrapped)

    def editionsMain(self, project, editions):
        &#34;&#34;&#34;Wrap the list of editions of a project for the main display.

        Parameters
        ----------
        project: AttrDict
            The master project record of the editions.
        editions: list of AttrDict
            The edition records.

        Returns
        -------
        string
            The HTML of the edition list
        &#34;&#34;&#34;
        Settings = self.Settings
        H = Settings.H
        representations = Settings.representations
        css = Settings.css
        Auth = self.Auth
        Content = self.Content

        wrapped = []

        for edition in editions:
            editionId = edition._id
            permitted = Auth.authorise(&#34;edition&#34;, record=edition, action=&#34;read&#34;)
            if not permitted:
                continue

            title = edition.title
            if not title:
                title = H(&#34;no title&#34;)
            stat = edition.isPublished or False
            status = representations.isPublished[stat]
            statusCls = css.isPublished[stat]

            editionUrl = f&#34;/edition/{editionId}&#34;
            button = self.contentButton(
                &#34;edition&#34;, edition, &#34;delete&#34;, confirm=True, text=&#34;Delete edition&#34;
            )
            visual = Content.getUpload(edition, &#34;iconEdition&#34;)
            caption = self.getCaption(
                visual, title, status, statusCls, button, editionUrl
            )
            wrapped.append(caption)

        wrapped.append(
            H.p(
                self.contentButton(
                    &#34;project&#34;,
                    project,
                    &#34;create&#34;,
                    insertTable=&#34;edition&#34;,
                    text=&#34;New Edition&#34;,
                )
            )
        )
        return H.content(*wrapped)

    def sceneMain(
        self, projectId, edition, sceneFile, viewer, version, action, sceneExists
    ):
        &#34;&#34;&#34;Wrap the scene of an edition for the main display.

        Parameters
        ----------
        projectId: ObjectId
            The id of the project to which the edition belongs.
        edition: AttrDict
            The edition record of the scene.
        viewer: string
            The viewer that will be used.
        version: string
            The version of the chosen viewer that will be used.
        action: string
            The mode in which the viewer should be opened.
        sceneExists: boolean
            Whether the scene file exists

        Returns
        -------
        string
            The HTML of the scene
        &#34;&#34;&#34;
        Settings = self.Settings
        H = Settings.H
        Auth = self.Auth
        Viewers = self.Viewers

        actions = Auth.authorise(&#34;edition&#34;, edition)
        if &#34;read&#34; not in actions:
            return &#34;&#34;

        wrapped = []

        # button = self.contentButton(
        #     &#34;edition&#34;, edition, &#34;delete&#34;, confirm=True, text=&#34;Delete scene&#34;
        # )

        titleText = H.span(sceneFile, cls=&#34;entrytitle&#34;)
        (frame, buttons) = Viewers.getFrame(
            edition, actions, viewer, version, action, sceneExists
        )
        title = H.span(titleText, cls=&#34;entrytitle&#34;)
        content = f&#34;&#34;&#34;{frame}{title}{buttons}&#34;&#34;&#34;
        caption = self.wrapCaption(content, None, None, active=True)

        wrapped.append(caption)
        return H.content(*wrapped)

    def getCaption(self, visual, titleText, status, statusCls, button, url):
        &#34;&#34;&#34;Produces a caption of a project or edition.

        Parameters
        ----------
        visual: string
            A link to an image to display in the caption.
        titleText: string
            The text on the caption.
        status: string
            The status of the project/edition: visible/hidden/published/in progress.
            The exact names
        statusCls: string
            The CSS class corresponding to `status`
        button: string
            Control for a certain action, or empty if the user is not authorised.
        url: string
            The url to navigate to if the user clicks the caption.
        &#34;&#34;&#34;
        Settings = self.Settings
        H = Settings.H

        title = H.span(titleText, cls=&#34;entrytitle&#34;)
        content = H.a(f&#34;{visual}{title}&#34;, url, cls=&#34;entry&#34;)
        statusBadge = H.div(status, cls=f&#34;pestatus {statusCls}&#34;)

        return self.wrapCaption(content, statusBadge, button)

    def wrapCaption(self, content, statusBadge, button, active=False):
        &#34;&#34;&#34;Assembles a caption from building blocks.&#34;&#34;&#34;
        Settings = self.Settings
        H = Settings.H

        activeCls = &#34;active&#34; if active else &#34;&#34;
        rest = []

        if statusBadge is not None:
            rest.append(statusBadge)

        rest.append(button)

        return H.div(
            [H.div(content, cls=f&#34;caption {activeCls}&#34;), *rest], cls=&#34;captioncontent&#34;
        )

    def contentButton(
        self,
        table,
        record,
        action,
        permitted=None,
        confirm=False,
        insertTable=None,
        key=None,
        href=None,
        text=None,
    ):
        &#34;&#34;&#34;Puts a button on the interface, if that makes sense.

        The button, when pressed, will lead to an action on certain content.
        It will be checked first if that action is allowed for the current user.
        If not the button will not be shown.

        !!! note &#34;Delete buttons&#34;
            Even if a user is authorised to delete a record,
            it is not allowed to delete master records if its detail records
            still exist.
            In that case, no delete button is displayed. Instead we display a count
            of detail records.

        !!! note &#34;Create buttons&#34;
            When placing a create button, the relevant record acts as the master
            record, to which the newly created record will be added as a detail.

        Parameters
        ----------
        table: string
            The relevant table.
        record: string | ObjectId | AttrDict
            The relevant record.
        action: string
            The type of action that will be performed if the button triggered.
        permitted: boolean, optional None
            If the permission for the action is already known before calling
            this function, it is passed here.
            If this parameter is None, we&#39;ll compute the permission.
        insertTable: string, optional None
            If the action is &#34;create&#34;, this is the table in which a record
            get inserted. The `table` and `record` arguments are then
            supposed to specify the *master* record of the newly inserted record.
            Needed to determine whether a press on the button is permitted.
        key: string, optional None
            If present, it identifies a field that is stored inside the
            record.
        href: string, optional None
            If present, contains the href attribute for the button.
        confirm: boolean, optional False
            Whether to ask the user for confirmation
        &#34;&#34;&#34;
        Auth = self.Auth
        Content = self.Content

        recordId = record._id

        permitted = (
            Auth.authorise(table, record, action=action, insertTable=insertTable)
            if permitted is None
            else permitted
        )

        if not permitted:
            return &#34;&#34;

        Settings = self.Settings
        H = Settings.H
        actions = Settings.auth.actions

        disable = False
        report = &#34;&#34;

        if action == &#34;delete&#34;:
            details = Content.getDetailRecords(table, record)
            if len(details):
                disable = True
                detailContent = []
                for detailTable, detailRecords in details.items():
                    nDetails = len(detailRecords)
                    plural = &#34;&#34; if nDetails == 1 else &#34;s&#34;
                    detailRep = detailTable + plural
                    detailContent.append(f&#34;&#34;&#34;{nDetails}{H.nbsp}{detailRep}&#34;&#34;&#34;)

                report = H.div(
                    [
                        H.span(thisContent, cls=&#34;dreport&#34;) + H.br()
                        for thisContent in detailContent
                    ]
                )
                report = H.br() + report

        actionInfo = actions.get(action, {})
        name = actionInfo.name
        keyRepTip = &#34;&#34; if key is None else f&#34; {key} of&#34;
        keyRepUrl = &#34;&#34; if key is None else f&#34;/{key}&#34;

        can = &#34;Cannot &#34; if disable else &#34;&#34;
        cls = &#34;disabled &#34; if disable else &#34;&#34;

        if action == &#34;create&#34;:
            href = f&#34;/{table}/{recordId}/{insertTable}/create&#34; if href is None else href
            tip = f&#34;{name} new {insertTable}&#34;
        else:
            href = f&#34;/{table}/{recordId}{keyRepUrl}/{action}&#34; if href is None else href
            tip = f&#34;{can}{name}{keyRepTip} this {table}&#34;

        confirmAtt = {}

        if disable:
            href = None
        else:
            confirmAtt = dict(confirm=&#34;v&#34; if confirm else &#34;x&#34;)

        fullCls = f&#34;button small {cls}&#34;
        return (
            H.iconx(action, href=href, title=tip, cls=fullCls, text=text, **confirmAtt)
            + report
        )</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="control.wrap.Wrap"><code class="flex name class">
<span>class <span class="ident">Wrap</span></span>
<span>(</span><span>Settings, Messages, Viewers)</span>
</code></dt>
<dd>
<div class="desc"><p>Wrap concepts into HTML.</p>
<p>This class knows how to wrap several higher-level concepts into HTML,
such as projects, editions and users, depending on specific
purposes, such as showing widgets to manage projects and editions.</p>
<p>It is instantiated by a singleton object.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>Settings</code></strong> :&ensp;<code>AttrDict</code></dt>
<dd>App-wide configuration data obtained from
<code><a title="control.config.Config.Settings" href="config.html#control.config.Config.Settings">Config.Settings</a></code>.</dd>
<dt><strong><code>Messages</code></strong> :&ensp;<code>object</code></dt>
<dd>Singleton instance of <code><a title="control.messages.Messages" href="messages.html#control.messages.Messages">Messages</a></code>.</dd>
<dt><strong><code>Viewers</code></strong> :&ensp;<code>object</code></dt>
<dd>Singleton instance of <code><a title="control.viewers.Viewers" href="viewers.html#control.viewers.Viewers">Viewers</a></code>.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/CLARIAH/pure3dx/blob/99a827eec565f9f7bf0633f62d3c060d35dd93dc/src/control/wrap.py#L4-L382" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class Wrap:
    def __init__(self, Settings, Messages, Viewers):
        &#34;&#34;&#34;Wrap concepts into HTML.

        This class knows how to wrap several higher-level concepts into HTML,
        such as projects, editions and users, depending on specific
        purposes, such as showing widgets to manage projects and editions.

        It is instantiated by a singleton object.

        Parameters
        ----------
        Settings: AttrDict
            App-wide configuration data obtained from
            `control.config.Config.Settings`.
        Messages: object
            Singleton instance of `control.messages.Messages`.
        Viewers: object
            Singleton instance of `control.viewers.Viewers`.
        &#34;&#34;&#34;
        self.Settings = Settings
        self.Messages = Messages
        self.Viewers = Viewers
        Messages.debugAdd(self)

    def addAuth(self, Auth):
        &#34;&#34;&#34;Give this object a handle to the Auth object.

        The Wrap and Auth objects need each other, so one of them must
        be given the handle to the other after initialization.
        &#34;&#34;&#34;
        self.Auth = Auth

    def addContent(self, Content):
        &#34;&#34;&#34;Give this object a handle to the Content object.

        The Wrap and Content objects need each other, so one of them must
        be given the handle to the other after initialization.
        &#34;&#34;&#34;
        self.Content = Content

    def projectsMain(self, site, projects):
        &#34;&#34;&#34;Wrap the list of projects for the main display.

        Parameters
        ----------
        site: AttrDict
            The record that corresponds to the site as a whole.
            It acts as a master record of the projects.
        projects: list of AttrDict
            The project records.

        Returns
        -------
        string
            The HTML of the project list
        &#34;&#34;&#34;
        Settings = self.Settings
        H = Settings.H
        representations = Settings.representations
        css = Settings.css
        Auth = self.Auth
        Content = self.Content

        wrapped = []
        wrapped.append(
            H.p(
                self.contentButton(
                    &#34;site&#34;, site, &#34;create&#34;, insertTable=&#34;project&#34;, text=&#34;New project&#34;
                )
            )
        )

        for project in projects:
            projectId = project._id
            permitted = Auth.authorise(&#34;project&#34;, project, action=&#34;read&#34;)

            if not permitted:
                continue

            title = project.title

            if not title:
                title = H(&#34;no title&#34;)

            stat = project.isVisible or False
            status = representations.isVisible[stat]
            statusCls = css.isVisible[stat]

            projectUrl = f&#34;/project/{projectId}&#34;
            button = self.contentButton(
                &#34;project&#34;, project, &#34;delete&#34;, confirm=True, text=&#34;Delete project&#34;
            )
            visual = Content.getUpload(project, &#34;iconProject&#34;)
            caption = self.getCaption(
                visual, title, status, statusCls, button, projectUrl
            )

            wrapped.append(caption)

        return H.content(*wrapped)

    def editionsMain(self, project, editions):
        &#34;&#34;&#34;Wrap the list of editions of a project for the main display.

        Parameters
        ----------
        project: AttrDict
            The master project record of the editions.
        editions: list of AttrDict
            The edition records.

        Returns
        -------
        string
            The HTML of the edition list
        &#34;&#34;&#34;
        Settings = self.Settings
        H = Settings.H
        representations = Settings.representations
        css = Settings.css
        Auth = self.Auth
        Content = self.Content

        wrapped = []

        for edition in editions:
            editionId = edition._id
            permitted = Auth.authorise(&#34;edition&#34;, record=edition, action=&#34;read&#34;)
            if not permitted:
                continue

            title = edition.title
            if not title:
                title = H(&#34;no title&#34;)
            stat = edition.isPublished or False
            status = representations.isPublished[stat]
            statusCls = css.isPublished[stat]

            editionUrl = f&#34;/edition/{editionId}&#34;
            button = self.contentButton(
                &#34;edition&#34;, edition, &#34;delete&#34;, confirm=True, text=&#34;Delete edition&#34;
            )
            visual = Content.getUpload(edition, &#34;iconEdition&#34;)
            caption = self.getCaption(
                visual, title, status, statusCls, button, editionUrl
            )
            wrapped.append(caption)

        wrapped.append(
            H.p(
                self.contentButton(
                    &#34;project&#34;,
                    project,
                    &#34;create&#34;,
                    insertTable=&#34;edition&#34;,
                    text=&#34;New Edition&#34;,
                )
            )
        )
        return H.content(*wrapped)

    def sceneMain(
        self, projectId, edition, sceneFile, viewer, version, action, sceneExists
    ):
        &#34;&#34;&#34;Wrap the scene of an edition for the main display.

        Parameters
        ----------
        projectId: ObjectId
            The id of the project to which the edition belongs.
        edition: AttrDict
            The edition record of the scene.
        viewer: string
            The viewer that will be used.
        version: string
            The version of the chosen viewer that will be used.
        action: string
            The mode in which the viewer should be opened.
        sceneExists: boolean
            Whether the scene file exists

        Returns
        -------
        string
            The HTML of the scene
        &#34;&#34;&#34;
        Settings = self.Settings
        H = Settings.H
        Auth = self.Auth
        Viewers = self.Viewers

        actions = Auth.authorise(&#34;edition&#34;, edition)
        if &#34;read&#34; not in actions:
            return &#34;&#34;

        wrapped = []

        # button = self.contentButton(
        #     &#34;edition&#34;, edition, &#34;delete&#34;, confirm=True, text=&#34;Delete scene&#34;
        # )

        titleText = H.span(sceneFile, cls=&#34;entrytitle&#34;)
        (frame, buttons) = Viewers.getFrame(
            edition, actions, viewer, version, action, sceneExists
        )
        title = H.span(titleText, cls=&#34;entrytitle&#34;)
        content = f&#34;&#34;&#34;{frame}{title}{buttons}&#34;&#34;&#34;
        caption = self.wrapCaption(content, None, None, active=True)

        wrapped.append(caption)
        return H.content(*wrapped)

    def getCaption(self, visual, titleText, status, statusCls, button, url):
        &#34;&#34;&#34;Produces a caption of a project or edition.

        Parameters
        ----------
        visual: string
            A link to an image to display in the caption.
        titleText: string
            The text on the caption.
        status: string
            The status of the project/edition: visible/hidden/published/in progress.
            The exact names
        statusCls: string
            The CSS class corresponding to `status`
        button: string
            Control for a certain action, or empty if the user is not authorised.
        url: string
            The url to navigate to if the user clicks the caption.
        &#34;&#34;&#34;
        Settings = self.Settings
        H = Settings.H

        title = H.span(titleText, cls=&#34;entrytitle&#34;)
        content = H.a(f&#34;{visual}{title}&#34;, url, cls=&#34;entry&#34;)
        statusBadge = H.div(status, cls=f&#34;pestatus {statusCls}&#34;)

        return self.wrapCaption(content, statusBadge, button)

    def wrapCaption(self, content, statusBadge, button, active=False):
        &#34;&#34;&#34;Assembles a caption from building blocks.&#34;&#34;&#34;
        Settings = self.Settings
        H = Settings.H

        activeCls = &#34;active&#34; if active else &#34;&#34;
        rest = []

        if statusBadge is not None:
            rest.append(statusBadge)

        rest.append(button)

        return H.div(
            [H.div(content, cls=f&#34;caption {activeCls}&#34;), *rest], cls=&#34;captioncontent&#34;
        )

    def contentButton(
        self,
        table,
        record,
        action,
        permitted=None,
        confirm=False,
        insertTable=None,
        key=None,
        href=None,
        text=None,
    ):
        &#34;&#34;&#34;Puts a button on the interface, if that makes sense.

        The button, when pressed, will lead to an action on certain content.
        It will be checked first if that action is allowed for the current user.
        If not the button will not be shown.

        !!! note &#34;Delete buttons&#34;
            Even if a user is authorised to delete a record,
            it is not allowed to delete master records if its detail records
            still exist.
            In that case, no delete button is displayed. Instead we display a count
            of detail records.

        !!! note &#34;Create buttons&#34;
            When placing a create button, the relevant record acts as the master
            record, to which the newly created record will be added as a detail.

        Parameters
        ----------
        table: string
            The relevant table.
        record: string | ObjectId | AttrDict
            The relevant record.
        action: string
            The type of action that will be performed if the button triggered.
        permitted: boolean, optional None
            If the permission for the action is already known before calling
            this function, it is passed here.
            If this parameter is None, we&#39;ll compute the permission.
        insertTable: string, optional None
            If the action is &#34;create&#34;, this is the table in which a record
            get inserted. The `table` and `record` arguments are then
            supposed to specify the *master* record of the newly inserted record.
            Needed to determine whether a press on the button is permitted.
        key: string, optional None
            If present, it identifies a field that is stored inside the
            record.
        href: string, optional None
            If present, contains the href attribute for the button.
        confirm: boolean, optional False
            Whether to ask the user for confirmation
        &#34;&#34;&#34;
        Auth = self.Auth
        Content = self.Content

        recordId = record._id

        permitted = (
            Auth.authorise(table, record, action=action, insertTable=insertTable)
            if permitted is None
            else permitted
        )

        if not permitted:
            return &#34;&#34;

        Settings = self.Settings
        H = Settings.H
        actions = Settings.auth.actions

        disable = False
        report = &#34;&#34;

        if action == &#34;delete&#34;:
            details = Content.getDetailRecords(table, record)
            if len(details):
                disable = True
                detailContent = []
                for detailTable, detailRecords in details.items():
                    nDetails = len(detailRecords)
                    plural = &#34;&#34; if nDetails == 1 else &#34;s&#34;
                    detailRep = detailTable + plural
                    detailContent.append(f&#34;&#34;&#34;{nDetails}{H.nbsp}{detailRep}&#34;&#34;&#34;)

                report = H.div(
                    [
                        H.span(thisContent, cls=&#34;dreport&#34;) + H.br()
                        for thisContent in detailContent
                    ]
                )
                report = H.br() + report

        actionInfo = actions.get(action, {})
        name = actionInfo.name
        keyRepTip = &#34;&#34; if key is None else f&#34; {key} of&#34;
        keyRepUrl = &#34;&#34; if key is None else f&#34;/{key}&#34;

        can = &#34;Cannot &#34; if disable else &#34;&#34;
        cls = &#34;disabled &#34; if disable else &#34;&#34;

        if action == &#34;create&#34;:
            href = f&#34;/{table}/{recordId}/{insertTable}/create&#34; if href is None else href
            tip = f&#34;{name} new {insertTable}&#34;
        else:
            href = f&#34;/{table}/{recordId}{keyRepUrl}/{action}&#34; if href is None else href
            tip = f&#34;{can}{name}{keyRepTip} this {table}&#34;

        confirmAtt = {}

        if disable:
            href = None
        else:
            confirmAtt = dict(confirm=&#34;v&#34; if confirm else &#34;x&#34;)

        fullCls = f&#34;button small {cls}&#34;
        return (
            H.iconx(action, href=href, title=tip, cls=fullCls, text=text, **confirmAtt)
            + report
        )</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="control.wrap.Wrap.addAuth"><code class="name flex">
<span>def <span class="ident">addAuth</span></span>(<span>self, Auth)</span>
</code></dt>
<dd>
<div class="desc"><p>Give this object a handle to the Auth object.</p>
<p>The Wrap and Auth objects need each other, so one of them must
be given the handle to the other after initialization.</p></div>
</dd>
<dt id="control.wrap.Wrap.addContent"><code class="name flex">
<span>def <span class="ident">addContent</span></span>(<span>self, Content)</span>
</code></dt>
<dd>
<div class="desc"><p>Give this object a handle to the Content object.</p>
<p>The Wrap and Content objects need each other, so one of them must
be given the handle to the other after initialization.</p></div>
</dd>
<dt id="control.wrap.Wrap.contentButton"><code class="name flex">
<span>def <span class="ident">contentButton</span></span>(<span>self, table, record, action, permitted=None, confirm=False, insertTable=None, key=None, href=None, text=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Puts a button on the interface, if that makes sense.</p>
<p>The button, when pressed, will lead to an action on certain content.
It will be checked first if that action is allowed for the current user.
If not the button will not be shown.</p>
<div class="admonition note">
<p class="admonition-title">Delete buttons</p>
<p>Even if a user is authorised to delete a record,
it is not allowed to delete master records if its detail records
still exist.
In that case, no delete button is displayed. Instead we display a count
of detail records.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Create buttons</p>
<p>When placing a create button, the relevant record acts as the master
record, to which the newly created record will be added as a detail.</p>
</div>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>table</code></strong> :&ensp;<code>string</code></dt>
<dd>The relevant table.</dd>
<dt><strong><code>record</code></strong> :&ensp;<code>string | ObjectId | AttrDict</code></dt>
<dd>The relevant record.</dd>
<dt><strong><code>action</code></strong> :&ensp;<code>string</code></dt>
<dd>The type of action that will be performed if the button triggered.</dd>
<dt><strong><code>permitted</code></strong> :&ensp;<code>boolean</code>, optional <code>None</code></dt>
<dd>If the permission for the action is already known before calling
this function, it is passed here.
If this parameter is None, we'll compute the permission.</dd>
<dt><strong><code>insertTable</code></strong> :&ensp;<code>string</code>, optional <code>None</code></dt>
<dd>If the action is "create", this is the table in which a record
get inserted. The <code>table</code> and <code>record</code> arguments are then
supposed to specify the <em>master</em> record of the newly inserted record.
Needed to determine whether a press on the button is permitted.</dd>
<dt><strong><code>key</code></strong> :&ensp;<code>string</code>, optional <code>None</code></dt>
<dd>If present, it identifies a field that is stored inside the
record.</dd>
<dt><strong><code>href</code></strong> :&ensp;<code>string</code>, optional <code>None</code></dt>
<dd>If present, contains the href attribute for the button.</dd>
<dt><strong><code>confirm</code></strong> :&ensp;<code>boolean</code>, optional <code>False</code></dt>
<dd>Whether to ask the user for confirmation</dd>
</dl></div>
</dd>
<dt id="control.wrap.Wrap.editionsMain"><code class="name flex">
<span>def <span class="ident">editionsMain</span></span>(<span>self, project, editions)</span>
</code></dt>
<dd>
<div class="desc"><p>Wrap the list of editions of a project for the main display.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>project</code></strong> :&ensp;<code>AttrDict</code></dt>
<dd>The master project record of the editions.</dd>
<dt><strong><code>editions</code></strong> :&ensp;<code>list</code> of <code>AttrDict</code></dt>
<dd>The edition records.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>string</code></dt>
<dd>The HTML of the edition list</dd>
</dl></div>
</dd>
<dt id="control.wrap.Wrap.getCaption"><code class="name flex">
<span>def <span class="ident">getCaption</span></span>(<span>self, visual, titleText, status, statusCls, button, url)</span>
</code></dt>
<dd>
<div class="desc"><p>Produces a caption of a project or edition.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>visual</code></strong> :&ensp;<code>string</code></dt>
<dd>A link to an image to display in the caption.</dd>
<dt><strong><code>titleText</code></strong> :&ensp;<code>string</code></dt>
<dd>The text on the caption.</dd>
<dt><strong><code>status</code></strong> :&ensp;<code>string</code></dt>
<dd>The status of the project/edition: visible/hidden/published/in progress.
The exact names</dd>
<dt><strong><code>statusCls</code></strong> :&ensp;<code>string</code></dt>
<dd>The CSS class corresponding to <code>status</code></dd>
<dt><strong><code>button</code></strong> :&ensp;<code>string</code></dt>
<dd>Control for a certain action, or empty if the user is not authorised.</dd>
<dt><strong><code>url</code></strong> :&ensp;<code>string</code></dt>
<dd>The url to navigate to if the user clicks the caption.</dd>
</dl></div>
</dd>
<dt id="control.wrap.Wrap.projectsMain"><code class="name flex">
<span>def <span class="ident">projectsMain</span></span>(<span>self, site, projects)</span>
</code></dt>
<dd>
<div class="desc"><p>Wrap the list of projects for the main display.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>site</code></strong> :&ensp;<code>AttrDict</code></dt>
<dd>The record that corresponds to the site as a whole.
It acts as a master record of the projects.</dd>
<dt><strong><code>projects</code></strong> :&ensp;<code>list</code> of <code>AttrDict</code></dt>
<dd>The project records.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>string</code></dt>
<dd>The HTML of the project list</dd>
</dl></div>
</dd>
<dt id="control.wrap.Wrap.sceneMain"><code class="name flex">
<span>def <span class="ident">sceneMain</span></span>(<span>self, projectId, edition, sceneFile, viewer, version, action, sceneExists)</span>
</code></dt>
<dd>
<div class="desc"><p>Wrap the scene of an edition for the main display.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>projectId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The id of the project to which the edition belongs.</dd>
<dt><strong><code>edition</code></strong> :&ensp;<code>AttrDict</code></dt>
<dd>The edition record of the scene.</dd>
<dt><strong><code>viewer</code></strong> :&ensp;<code>string</code></dt>
<dd>The viewer that will be used.</dd>
<dt><strong><code>version</code></strong> :&ensp;<code>string</code></dt>
<dd>The version of the chosen viewer that will be used.</dd>
<dt><strong><code>action</code></strong> :&ensp;<code>string</code></dt>
<dd>The mode in which the viewer should be opened.</dd>
<dt><strong><code>sceneExists</code></strong> :&ensp;<code>boolean</code></dt>
<dd>Whether the scene file exists</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>string</code></dt>
<dd>The HTML of the scene</dd>
</dl></div>
</dd>
<dt id="control.wrap.Wrap.wrapCaption"><code class="name flex">
<span>def <span class="ident">wrapCaption</span></span>(<span>self, content, statusBadge, button, active=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Assembles a caption from building blocks.</p></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<p><a href="https://github.com/CLARIAH/pure3dx" title="GitHub repo">GitHub</a></p>
<p><a href="https://github.com/CLARIAH/pure3dx/blob/main/stats.md" title="GitHub repo">code stats</a></p>
<form>
<input id="lunr-search" name="q" placeholder="🔎 Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="control" href="index.html">control</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="control.wrap.Wrap" href="#control.wrap.Wrap">Wrap</a></code></h4>
<ul class="two-column">
<li><code><a title="control.wrap.Wrap.addAuth" href="#control.wrap.Wrap.addAuth">addAuth</a></code></li>
<li><code><a title="control.wrap.Wrap.addContent" href="#control.wrap.Wrap.addContent">addContent</a></code></li>
<li><code><a title="control.wrap.Wrap.contentButton" href="#control.wrap.Wrap.contentButton">contentButton</a></code></li>
<li><code><a title="control.wrap.Wrap.editionsMain" href="#control.wrap.Wrap.editionsMain">editionsMain</a></code></li>
<li><code><a title="control.wrap.Wrap.getCaption" href="#control.wrap.Wrap.getCaption">getCaption</a></code></li>
<li><code><a title="control.wrap.Wrap.projectsMain" href="#control.wrap.Wrap.projectsMain">projectsMain</a></code></li>
<li><code><a title="control.wrap.Wrap.sceneMain" href="#control.wrap.Wrap.sceneMain">sceneMain</a></code></li>
<li><code><a title="control.wrap.Wrap.wrapCaption" href="#control.wrap.Wrap.wrapCaption">wrapCaption</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<a href="https://pure.knaw.nl/portal/en/persons/dirk-roorda">Dirk Roorda</a>
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.11.1</a>.</p>
</footer>
</body>
</html>
